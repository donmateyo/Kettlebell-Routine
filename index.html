<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <title>Progressive Bodyweight Workout</title>
    <meta
      name="description"
      content="Progressive bodyweight workout app with proven exercises for full-body training"
    />
    <meta name="theme-color" content="#1a1a1a" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="apple-mobile-web-app-title" content="BW Workout" />

    <script>
      // Generate icon
      (function generateIconsAndManifest() {
        function drawIcon(size) {
          const c = document.createElement("canvas");
          c.width = c.height = size;
          const ctx = c.getContext("2d");

          // Gradient background
          const g = ctx.createLinearGradient(0, 0, size, size);
          g.addColorStop(0, "#1e3a8a");
          g.addColorStop(0.5, "#3b82f6");
          g.addColorStop(1, "#1e40af");
          ctx.fillStyle = g;
          ctx.fillRect(0, 0, size, size);

          // Muscle icon (simple representation)
          ctx.save();
          const s = size / 512;
          ctx.scale(s, s);

          // Glow effect
          ctx.shadowColor = "rgba(59, 130, 246, 0.8)";
          ctx.shadowBlur = 40;
          
          // Draw stylized person doing push-up
          ctx.fillStyle = "#fff";
          ctx.strokeStyle = "#fff";
          ctx.lineWidth = 20;
          ctx.lineCap = "round";
          ctx.lineJoin = "round";

          // Body
          ctx.beginPath();
          ctx.arc(200, 180, 40, 0, Math.PI * 2); // Head
          ctx.fill();
          
          // Arms and body
          ctx.beginPath();
          ctx.moveTo(200, 220);
          ctx.lineTo(200, 320);
          ctx.lineTo(120, 380);
          ctx.moveTo(200, 320);
          ctx.lineTo(280, 380);
          ctx.moveTo(200, 240);
          ctx.lineTo(120, 280);
          ctx.moveTo(200, 240);
          ctx.lineTo(280, 280);
          ctx.stroke();

          ctx.restore();
          return c.toDataURL("image/png");
        }

        const icon180 = drawIcon(180);
        const icon192 = drawIcon(192);
        const icon512 = drawIcon(512);

        const apple = document.createElement("link");
        apple.rel = "apple-touch-icon";
        apple.href = icon180;
        document.head.appendChild(apple);

        const fav = document.createElement("link");
        fav.rel = "icon";
        fav.type = "image/png";
        fav.href = icon192;
        document.head.appendChild(fav);

        const manifest = {
          name: "Progressive Bodyweight Workout",
          short_name: "BW Workout",
          start_url: "/",
          scope: "/",
          display: "standalone",
          background_color: "#1a1a1a",
          theme_color: "#3b82f6",
          description: "Progressive bodyweight workout app with proven exercises",
          icons: [
            { src: icon192, sizes: "192x192", type: "image/png" },
            { src: icon512, sizes: "512x512", type: "image/png", purpose: "any maskable" }
          ]
        };

        const blob = new Blob([JSON.stringify(manifest)], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const link = document.createElement("link");
        link.rel = "manifest";
        link.href = url;
        document.head.appendChild(link);
      })();
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = { darkMode: "class" };
    </script>

    <style>
      :root {
        color-scheme: dark;
      }

      input, select, textarea {
        font-size: 16px !important;
      }

      body {
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
        min-height: 100vh;
      }

      .workout-card {
        background: linear-gradient(145deg, rgba(30, 41, 59, 0.95), rgba(15, 23, 42, 0.95));
        border: 2px solid #3b82f6;
        box-shadow: 0 0 30px rgba(59, 130, 246, 0.2), 0 10px 40px rgba(0, 0, 0, 0.8);
        transition: all 0.3s ease;
      }

      .workout-card:hover {
        border-color: #60a5fa;
        box-shadow: 0 0 40px rgba(59, 130, 246, 0.3), 0 10px 50px rgba(0, 0, 0, 0.9);
      }

      .btn-primary {
        background: linear-gradient(135deg, #3b82f6, #2563eb);
        transition: all 0.2s ease;
      }

      .btn-primary:hover {
        background: linear-gradient(135deg, #60a5fa, #3b82f6);
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(59, 130, 246, 0.4);
      }

      .btn-primary:active {
        transform: translateY(0);
      }

      .exercise-complete {
        background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(22, 163, 74, 0.2));
        border-color: #22c55e;
      }

      .progress-bar {
        transition: width 0.5s ease;
      }

      @keyframes pulse-glow {
        0%, 100% {
          box-shadow: 0 0 20px rgba(59, 130, 246, 0.4);
        }
        50% {
          box-shadow: 0 0 40px rgba(59, 130, 246, 0.8);
        }
      }

      .active-exercise {
        animation: pulse-glow 2s infinite;
      }

      .timer-display {
        font-variant-numeric: tabular-nums;
        font-family: 'Courier New', monospace;
      }

      input, select, textarea {
        background: rgba(15, 23, 42, 0.8) !important;
        border: 1px solid #3b82f6 !important;
        color: #e2e8f0 !important;
      }

      input:focus, select:focus, textarea:focus {
        outline: none !important;
        border-color: #60a5fa !important;
        box-shadow: 0 0 10px rgba(59, 130, 246, 0.5) !important;
      }

      @media all and (display-mode: standalone) {
        body {
          padding-top: env(safe-area-inset-top);
          padding-bottom: env(safe-area-inset-bottom);
        }
      }
    </style>
  </head>

  <body class="text-slate-100 min-h-screen">
    <div id="app" class="max-w-2xl mx-auto pb-20">
      <!-- Header -->
      <header class="workout-card text-blue-400 p-5 m-4 sticky top-4 z-40">
        <div class="flex items-center justify-between">
          <div>
            <h1 class="text-2xl font-bold tracking-wider">BODYWEIGHT</h1>
            <p class="text-sm text-slate-400">Progressive Training</p>
          </div>
          
          <div class="flex gap-2">
            <button
              id="infoBtn"
              class="text-blue-400/80 hover:text-blue-300 transition-colors p-2 hover:bg-blue-500/10 rounded"
              title="Info"
            >
              <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
              </svg>
            </button>
            <button
              id="historyBtn"
              class="text-blue-400/80 hover:text-blue-300 transition-colors p-2 hover:bg-blue-500/10 rounded"
              title="History"
            >
              <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"/>
              </svg>
            </button>
            <button
              id="settingsBtn"
              class="text-blue-400/80 hover:text-blue-300 transition-colors p-2 hover:bg-blue-500/10 rounded"
              title="Settings"
            >
              <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"/>
              </svg>
            </button>
          </div>
        </div>
      </header>

      <!-- Main Content -->
      <main class="p-4 space-y-6">
        <!-- Stats Dashboard -->
        <div class="workout-card p-5">
          <h3 class="font-bold text-blue-400 mb-3">PROGRESS STATS</h3>
          <div class="grid grid-cols-3 gap-3">
            <div class="bg-slate-900/50 p-3 rounded border border-blue-500/30 text-center">
              <div class="text-slate-400 text-xs uppercase">Workouts</div>
              <div id="totalWorkouts" class="text-2xl font-bold text-blue-400 mt-1">0</div>
            </div>
            <div class="bg-slate-900/50 p-3 rounded border border-blue-500/30 text-center">
              <div class="text-slate-400 text-xs uppercase">This Week</div>
              <div id="weekWorkouts" class="text-2xl font-bold text-blue-400 mt-1">0/3</div>
            </div>
            <div class="bg-slate-900/50 p-3 rounded border border-blue-500/30 text-center">
              <div class="text-slate-400 text-xs uppercase">Level</div>
              <div id="currentLevel" class="text-2xl font-bold text-blue-400 mt-1">1</div>
            </div>
          </div>
        </div>

        <!-- Workout Status -->
        <div id="workoutStatus" class="workout-card p-6 text-center">
          <div class="text-sm uppercase tracking-wider text-blue-400 mb-2">Ready to Train</div>
          <div class="text-3xl font-bold mb-3">FULL BODY WORKOUT</div>
          <div class="text-slate-400 mb-4">8 exercises • Progressive difficulty</div>
          <button
            id="startWorkoutBtn"
            class="btn-primary w-full py-4 text-lg font-bold uppercase tracking-wider rounded-lg"
          >
            Start Workout
          </button>
        </div>

        <!-- Active Workout View -->
        <div id="activeWorkout" class="hidden space-y-4">
          <!-- Current Exercise -->
          <div id="currentExerciseCard" class="workout-card p-6 active-exercise">
            <div class="flex justify-between items-start mb-4">
              <div>
                <div class="text-xs text-blue-400 uppercase tracking-wider mb-1">Current Exercise</div>
                <h2 id="exerciseName" class="text-2xl font-bold mb-1">Push-ups</h2>
                <p id="exerciseLevel" class="text-sm text-slate-400">Level 1: Standard</p>
              </div>
              <div class="text-right">
                <div class="text-xs text-slate-400 uppercase">Exercise</div>
                <div id="exerciseNumber" class="text-2xl font-bold text-blue-400">1/8</div>
              </div>
            </div>
            
            <div class="mb-4">
              <div class="text-sm text-slate-400 mb-2">Target Reps</div>
              <div id="targetReps" class="text-4xl font-bold text-blue-400">12</div>
            </div>

            <div class="mb-4">
              <label class="block text-sm text-slate-400 mb-2">Reps Completed</label>
              <input
                id="repsInput"
                type="number"
                min="0"
                class="w-full px-4 py-3 text-2xl font-bold text-center rounded"
              />
            </div>

            <!-- Rest Timer -->
            <div id="restTimer" class="hidden mb-4 text-center">
              <div class="text-sm text-slate-400 mb-2">Rest Time</div>
              <div id="restTimeDisplay" class="text-5xl font-bold text-blue-400 timer-display">90</div>
              <div class="text-xs text-slate-400 mt-1">seconds</div>
            </div>

            <div class="grid grid-cols-2 gap-3">
              <button
                id="completeExerciseBtn"
                class="btn-primary py-3 font-bold uppercase rounded-lg"
              >
                Complete
              </button>
              <button
                id="skipExerciseBtn"
                class="bg-slate-700 hover:bg-slate-600 py-3 font-bold uppercase rounded-lg transition-colors"
              >
                Skip
              </button>
            </div>
          </div>

          <!-- Progress Tracker -->
          <div class="workout-card p-5">
            <div class="flex justify-between items-center mb-3">
              <h3 class="font-bold text-blue-400">WORKOUT PROGRESS</h3>
              <span id="progressPercentage" class="text-sm text-slate-400">0%</span>
            </div>
            <div class="bg-slate-900/50 rounded-full h-3 mb-4 overflow-hidden">
              <div id="progressBar" class="progress-bar bg-blue-500 h-full rounded-full" style="width: 0%"></div>
            </div>
            <div id="exerciseList" class="space-y-2"></div>
          </div>

          <button
            id="stopWorkoutBtn"
            class="w-full bg-red-600/80 hover:bg-red-600 py-3 font-bold uppercase rounded-lg transition-colors"
          >
            End Workout
          </button>
        </div>

        <!-- Workout Complete View -->
        <div id="workoutComplete" class="hidden workout-card p-6 text-center">
          <div class="text-5xl mb-4">🎉</div>
          <div class="text-3xl font-bold mb-2">Workout Complete!</div>
          <div id="workoutSummary" class="text-slate-400 mb-6"></div>
          <div id="progressionAdvice" class="bg-blue-500/20 border border-blue-500/50 rounded p-4 mb-4 text-sm"></div>
          <button
            id="finishBtn"
            class="btn-primary w-full py-3 font-bold uppercase rounded-lg"
          >
            Finish
          </button>
        </div>
      </main>

      <!-- Info Modal -->
      <div id="infoModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden z-50 flex items-center justify-center p-4">
        <div class="workout-card w-full max-w-lg p-6 max-h-[85vh] overflow-y-auto">
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold text-blue-400">WORKOUT INFO</h2>
            <button id="closeInfo" class="text-slate-400 hover:text-slate-200">
              <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
              </svg>
            </button>
          </div>

          <div class="space-y-4 text-sm">
            <div>
              <h3 class="font-bold text-blue-400 mb-2">PROGRAM OVERVIEW</h3>
              <p class="text-slate-300 mb-2">
                A progressive full-body bodyweight routine designed for 3x per week training. 
                The program uses proven exercises and progressive overload to build strength and muscle.
              </p>
            </div>

            <div>
              <h3 class="font-bold text-blue-400 mb-2">EXERCISES</h3>
              <ul class="space-y-1 text-slate-300">
                <li>• <strong>Push-ups:</strong> Chest, shoulders, triceps</li>
                <li>• <strong>Pull-ups:</strong> Back, biceps (use progressions if needed)</li>
                <li>• <strong>Squats:</strong> Legs, glutes</li>
                <li>• <strong>Dips:</strong> Triceps, chest</li>
                <li>• <strong>Rows:</strong> Back, biceps</li>
                <li>• <strong>Pike Push-ups:</strong> Shoulders</li>
                <li>• <strong>Leg Raises:</strong> Core</li>
                <li>• <strong>Plank:</strong> Core stability</li>
              </ul>
            </div>

            <div>
              <h3 class="font-bold text-blue-400 mb-2">PROGRESSION SYSTEM</h3>
              <ul class="space-y-1 text-slate-300">
                <li>• Complete target reps for 2 consecutive workouts to progress</li>
                <li>• Each level increases difficulty with more reps or harder variations</li>
                <li>• Track your performance to see improvements over time</li>
              </ul>
            </div>

            <div>
              <h3 class="font-bold text-blue-400 mb-2">TIPS</h3>
              <ul class="space-y-1 text-slate-300">
                <li>• Focus on proper form over reps</li>
                <li>• Rest 90-120 seconds between exercises</li>
                <li>• Train 3x per week with rest days between</li>
                <li>• Stay consistent for best results</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- History Modal -->
      <div id="historyModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden z-50 flex items-center justify-center p-4">
        <div class="workout-card w-full max-w-lg p-6 max-h-[85vh] overflow-y-auto">
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold text-blue-400">WORKOUT HISTORY</h2>
            <button id="closeHistory" class="text-slate-400 hover:text-slate-200">
              <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
              </svg>
            </button>
          </div>

          <div id="historyList" class="space-y-3"></div>
        </div>
      </div>

      <!-- Settings Modal -->
      <div id="settingsModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden z-50 flex items-center justify-center p-4">
        <div class="workout-card w-full max-w-sm p-6">
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold text-blue-400">SETTINGS</h2>
            <button id="closeSettings" class="text-slate-400 hover:text-slate-200">
              <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
              </svg>
            </button>
          </div>

          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium mb-2 text-blue-400">
                Rest Time (seconds)
              </label>
              <input
                type="number"
                id="restTimeSetting"
                min="30"
                max="300"
                step="10"
                value="90"
                class="w-full px-4 py-2 rounded"
              />
            </div>

            <div>
              <label class="flex items-center cursor-pointer">
                <input
                  type="checkbox"
                  id="soundAlerts"
                  class="mr-3 w-5 h-5 cursor-pointer accent-blue-500"
                  checked
                />
                <span>Enable sound alerts</span>
              </label>
            </div>

            <button
              id="resetProgress"
              class="w-full bg-red-600/80 hover:bg-red-600 py-3 font-bold uppercase rounded-lg transition-colors"
            >
              Reset All Progress
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Exercise Database with Progressive Levels
      const EXERCISES = [
        {
          id: 'pushups',
          name: 'Push-ups',
          category: 'Push',
          levels: [
            { level: 1, name: 'Standard Push-ups', reps: 12 },
            { level: 2, name: 'Standard Push-ups', reps: 15 },
            { level: 3, name: 'Standard Push-ups', reps: 20 },
            { level: 4, name: 'Diamond Push-ups', reps: 12 },
            { level: 5, name: 'Diamond Push-ups', reps: 15 },
            { level: 6, name: 'Archer Push-ups', reps: 10 },
            { level: 7, name: 'Archer Push-ups', reps: 12 },
            { level: 8, name: 'One-Arm Push-up Progression', reps: 8 }
          ]
        },
        {
          id: 'pullups',
          name: 'Pull-ups',
          category: 'Pull',
          levels: [
            { level: 1, name: 'Assisted Pull-ups (Band)', reps: 8 },
            { level: 2, name: 'Negative Pull-ups', reps: 5 },
            { level: 3, name: 'Standard Pull-ups', reps: 5 },
            { level: 4, name: 'Standard Pull-ups', reps: 8 },
            { level: 5, name: 'Standard Pull-ups', reps: 10 },
            { level: 6, name: 'L-Sit Pull-ups', reps: 6 },
            { level: 7, name: 'Archer Pull-ups', reps: 5 },
            { level: 8, name: 'One-Arm Pull-up Progression', reps: 3 }
          ]
        },
        {
          id: 'squats',
          name: 'Squats',
          category: 'Legs',
          levels: [
            { level: 1, name: 'Bodyweight Squats', reps: 15 },
            { level: 2, name: 'Bodyweight Squats', reps: 20 },
            { level: 3, name: 'Bodyweight Squats', reps: 25 },
            { level: 4, name: 'Jump Squats', reps: 15 },
            { level: 5, name: 'Bulgarian Split Squats', reps: 12 },
            { level: 6, name: 'Pistol Squat Progression', reps: 8 },
            { level: 7, name: 'Pistol Squats', reps: 8 },
            { level: 8, name: 'Pistol Squats', reps: 10 }
          ]
        },
        {
          id: 'dips',
          name: 'Dips',
          category: 'Push',
          levels: [
            { level: 1, name: 'Bench Dips', reps: 12 },
            { level: 2, name: 'Bench Dips', reps: 15 },
            { level: 3, name: 'Parallel Bar Dips', reps: 8 },
            { level: 4, name: 'Parallel Bar Dips', reps: 10 },
            { level: 5, name: 'Parallel Bar Dips', reps: 12 },
            { level: 6, name: 'Ring Dips', reps: 8 },
            { level: 7, name: 'Weighted Dips', reps: 10 },
            { level: 8, name: 'Weighted Dips', reps: 12 }
          ]
        },
        {
          id: 'rows',
          name: 'Rows',
          category: 'Pull',
          levels: [
            { level: 1, name: 'Incline Rows', reps: 12 },
            { level: 2, name: 'Incline Rows', reps: 15 },
            { level: 3, name: 'Horizontal Rows', reps: 10 },
            { level: 4, name: 'Horizontal Rows', reps: 12 },
            { level: 5, name: 'Horizontal Rows', reps: 15 },
            { level: 6, name: 'Archer Rows', reps: 10 },
            { level: 7, name: 'One-Arm Row Progression', reps: 8 },
            { level: 8, name: 'One-Arm Rows', reps: 10 }
          ]
        },
        {
          id: 'pike_pushups',
          name: 'Pike Push-ups',
          category: 'Push',
          levels: [
            { level: 1, name: 'Pike Push-ups', reps: 10 },
            { level: 2, name: 'Pike Push-ups', reps: 12 },
            { level: 3, name: 'Pike Push-ups', reps: 15 },
            { level: 4, name: 'Elevated Pike Push-ups', reps: 10 },
            { level: 5, name: 'Elevated Pike Push-ups', reps: 12 },
            { level: 6, name: 'Wall Handstand Push-up Progression', reps: 8 },
            { level: 7, name: 'Handstand Push-ups (Wall)', reps: 5 },
            { level: 8, name: 'Handstand Push-ups (Wall)', reps: 8 }
          ]
        },
        {
          id: 'leg_raises',
          name: 'Leg Raises',
          category: 'Core',
          levels: [
            { level: 1, name: 'Knee Raises', reps: 12 },
            { level: 2, name: 'Knee Raises', reps: 15 },
            { level: 3, name: 'Straight Leg Raises', reps: 10 },
            { level: 4, name: 'Straight Leg Raises', reps: 12 },
            { level: 5, name: 'Straight Leg Raises', reps: 15 },
            { level: 6, name: 'Hanging Leg Raises', reps: 10 },
            { level: 7, name: 'Toes to Bar', reps: 8 },
            { level: 8, name: 'Toes to Bar', reps: 12 }
          ]
        },
        {
          id: 'plank',
          name: 'Plank',
          category: 'Core',
          levels: [
            { level: 1, name: 'Plank', reps: 30 },
            { level: 2, name: 'Plank', reps: 45 },
            { level: 3, name: 'Plank', reps: 60 },
            { level: 4, name: 'Plank', reps: 75 },
            { level: 5, name: 'Plank', reps: 90 },
            { level: 6, name: 'Plank', reps: 120 },
            { level: 7, name: 'Weighted Plank', reps: 60 },
            { level: 8, name: 'Weighted Plank', reps: 90 }
          ]
        }
      ];

      // State
      let state = {
        workoutInProgress: false,
        currentExerciseIndex: 0,
        workoutData: [],
        exerciseLevels: {},
        settings: {
          restTime: 90,
          soundEnabled: true
        },
        history: [],
        restTimerActive: false,
        restSecondsRemaining: 0
      };

      let restInterval = null;
      let audioContext = null;

      // Storage keys
      const STORAGE_KEYS = {
        LEVELS: 'bw_exercise_levels',
        HISTORY: 'bw_workout_history',
        SETTINGS: 'bw_settings'
      };

      // Elements
      const startWorkoutBtn = document.getElementById('startWorkoutBtn');
      const workoutStatus = document.getElementById('workoutStatus');
      const activeWorkout = document.getElementById('activeWorkout');
      const workoutComplete = document.getElementById('workoutComplete');
      const currentExerciseCard = document.getElementById('currentExerciseCard');
      const exerciseName = document.getElementById('exerciseName');
      const exerciseLevel = document.getElementById('exerciseLevel');
      const exerciseNumber = document.getElementById('exerciseNumber');
      const targetReps = document.getElementById('targetReps');
      const repsInput = document.getElementById('repsInput');
      const completeExerciseBtn = document.getElementById('completeExerciseBtn');
      const skipExerciseBtn = document.getElementById('skipExerciseBtn');
      const stopWorkoutBtn = document.getElementById('stopWorkoutBtn');
      const progressBar = document.getElementById('progressBar');
      const progressPercentage = document.getElementById('progressPercentage');
      const exerciseList = document.getElementById('exerciseList');
      const restTimer = document.getElementById('restTimer');
      const restTimeDisplay = document.getElementById('restTimeDisplay');
      const finishBtn = document.getElementById('finishBtn');
      const workoutSummary = document.getElementById('workoutSummary');
      const progressionAdvice = document.getElementById('progressionAdvice');

      // Stats
      const totalWorkouts = document.getElementById('totalWorkouts');
      const weekWorkouts = document.getElementById('weekWorkouts');
      const currentLevel = document.getElementById('currentLevel');

      // Modals
      const infoModal = document.getElementById('infoModal');
      const historyModal = document.getElementById('historyModal');
      const settingsModal = document.getElementById('settingsModal');
      const infoBtn = document.getElementById('infoBtn');
      const historyBtn = document.getElementById('historyBtn');
      const settingsBtn = document.getElementById('settingsBtn');
      const closeInfo = document.getElementById('closeInfo');
      const closeHistory = document.getElementById('closeHistory');
      const closeSettings = document.getElementById('closeSettings');
      const historyList = document.getElementById('historyList');
      const restTimeSetting = document.getElementById('restTimeSetting');
      const soundAlerts = document.getElementById('soundAlerts');
      const resetProgress = document.getElementById('resetProgress');

      // Initialize
      function init() {
        loadData();
        updateStatsDisplay();
        setupEventListeners();
      }

      // Load saved data
      function loadData() {
        try {
          const savedLevels = localStorage.getItem(STORAGE_KEYS.LEVELS);
          if (savedLevels) {
            state.exerciseLevels = JSON.parse(savedLevels);
          } else {
            // Initialize all exercises at level 1
            EXERCISES.forEach(ex => {
              state.exerciseLevels[ex.id] = { level: 1, successCount: 0 };
            });
          }

          const savedHistory = localStorage.getItem(STORAGE_KEYS.HISTORY);
          if (savedHistory) {
            state.history = JSON.parse(savedHistory);
          }

          const savedSettings = localStorage.getItem(STORAGE_KEYS.SETTINGS);
          if (savedSettings) {
            state.settings = JSON.parse(savedSettings);
            restTimeSetting.value = state.settings.restTime;
            soundAlerts.checked = state.settings.soundEnabled;
          }
        } catch (error) {
          console.error('Error loading data:', error);
        }
      }

      // Save data
      function saveData() {
        try {
          localStorage.setItem(STORAGE_KEYS.LEVELS, JSON.stringify(state.exerciseLevels));
          localStorage.setItem(STORAGE_KEYS.HISTORY, JSON.stringify(state.history));
          localStorage.setItem(STORAGE_KEYS.SETTINGS, JSON.stringify(state.settings));
        } catch (error) {
          console.error('Error saving data:', error);
        }
      }

      // Update stats display
      function updateStatsDisplay() {
        totalWorkouts.textContent = state.history.length;
        
        // Count this week's workouts
        const now = new Date();
        const weekStart = new Date(now);
        weekStart.setDate(now.getDate() - now.getDay()); // Start of week
        weekStart.setHours(0, 0, 0, 0);
        
        const thisWeek = state.history.filter(w => new Date(w.date) >= weekStart).length;
        weekWorkouts.textContent = `${thisWeek}/3`;

        // Calculate average level
        const avgLevel = Math.round(
          Object.values(state.exerciseLevels).reduce((sum, ex) => sum + ex.level, 0) / 
          EXERCISES.length
        );
        currentLevel.textContent = avgLevel;
      }

      // Audio
      function initAudio() {
        if (!audioContext) {
          audioContext = new (window.AudioContext || window.webkitAudioContext)();
        }
      }

      function playBeep(frequency = 800, duration = 200) {
        if (!state.settings.soundEnabled || !audioContext) return;
        const osc = audioContext.createOscillator();
        const gain = audioContext.createGain();
        osc.connect(gain);
        gain.connect(audioContext.destination);
        osc.frequency.value = frequency;
        osc.type = 'sine';
        gain.gain.setValueAtTime(0.1, audioContext.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration / 1000);
        osc.start(audioContext.currentTime);
        osc.stop(audioContext.currentTime + duration / 1000);
      }

      // Start workout
      function startWorkout() {
        initAudio();
        state.workoutInProgress = true;
        state.currentExerciseIndex = 0;
        state.workoutData = EXERCISES.map(ex => {
          const levelData = state.exerciseLevels[ex.id] || { level: 1 };
          const exerciseLevel = ex.levels[levelData.level - 1];
          return {
            exercise: ex,
            level: levelData.level,
            targetReps: exerciseLevel.reps,
            completedReps: null,
            skipped: false
          };
        });

        workoutStatus.classList.add('hidden');
        activeWorkout.classList.remove('hidden');
        
        displayCurrentExercise();
        updateExerciseList();
        playBeep(1000, 300);
      }

      // Display current exercise
      function displayCurrentExercise() {
        if (state.currentExerciseIndex >= state.workoutData.length) {
          finishWorkout();
          return;
        }

        const current = state.workoutData[state.currentExerciseIndex];
        const levelInfo = current.exercise.levels[current.level - 1];
        
        exerciseName.textContent = current.exercise.name;
        exerciseLevel.textContent = `Level ${current.level}: ${levelInfo.name}`;
        exerciseNumber.textContent = `${state.currentExerciseIndex + 1}/${state.workoutData.length}`;
        
        if (current.exercise.id === 'plank') {
          targetReps.textContent = `${current.targetReps}s`;
          repsInput.placeholder = 'Seconds held';
        } else {
          targetReps.textContent = current.targetReps;
          repsInput.placeholder = 'Reps completed';
        }
        
        repsInput.value = '';
        repsInput.focus();

        updateProgress();
        scrollToTop();
      }

      function scrollToTop() {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }

      // Update progress
      function updateProgress() {
        const total = state.workoutData.length;
        const completed = state.workoutData.filter(ex => 
          ex.completedReps !== null || ex.skipped
        ).length;
        const percentage = Math.round((completed / total) * 100);
        
        progressBar.style.width = `${percentage}%`;
        progressPercentage.textContent = `${percentage}%`;
      }

      // Update exercise list
      function updateExerciseList() {
        exerciseList.innerHTML = state.workoutData.map((ex, idx) => {
          let status = '';
          let statusClass = '';
          
          if (ex.completedReps !== null) {
            status = `✓ ${ex.completedReps}`;
            statusClass = 'text-green-400';
          } else if (ex.skipped) {
            status = '⊘ Skipped';
            statusClass = 'text-slate-500';
          } else if (idx === state.currentExerciseIndex) {
            status = 'In Progress';
            statusClass = 'text-blue-400 font-bold';
          } else {
            status = `${ex.targetReps}${ex.exercise.id === 'plank' ? 's' : ''}`;
            statusClass = 'text-slate-400';
          }

          return `
            <div class="flex justify-between items-center text-sm ${idx === state.currentExerciseIndex ? 'bg-blue-500/10 p-2 rounded' : ''}">
              <span class="${idx < state.currentExerciseIndex ? 'text-slate-400' : ''}">${ex.exercise.name}</span>
              <span class="${statusClass}">${status}</span>
            </div>
          `;
        }).join('');
      }

      // Complete exercise
      function completeExercise() {
        const reps = parseInt(repsInput.value);
        if (isNaN(reps) || reps < 0) {
          alert('Please enter a valid number of reps');
          return;
        }

        const current = state.workoutData[state.currentExerciseIndex];
        current.completedReps = reps;

        // Check for progression
        if (reps >= current.targetReps) {
          const exLevel = state.exerciseLevels[current.exercise.id];
          exLevel.successCount = (exLevel.successCount || 0) + 1;
          
          // Progress after 2 successful workouts
          if (exLevel.successCount >= 2 && exLevel.level < current.exercise.levels.length) {
            exLevel.level++;
            exLevel.successCount = 0;
          }
        } else {
          // Reset success count if didn't hit target
          state.exerciseLevels[current.exercise.id].successCount = 0;
        }

        saveData();
        updateExerciseList();

        // Start rest timer
        if (state.currentExerciseIndex < state.workoutData.length - 1) {
          startRestTimer();
        } else {
          state.currentExerciseIndex++;
          displayCurrentExercise();
        }

        playBeep(1200, 200);
      }

      // Skip exercise
      function skipExercise() {
        const current = state.workoutData[state.currentExerciseIndex];
        current.skipped = true;
        state.exerciseLevels[current.exercise.id].successCount = 0;
        
        saveData();
        updateExerciseList();

        state.currentExerciseIndex++;
        displayCurrentExercise();
      }

      // Rest timer
      function startRestTimer() {
        state.restTimerActive = true;
        state.restSecondsRemaining = state.settings.restTime;
        
        repsInput.classList.add('hidden');
        completeExerciseBtn.classList.add('hidden');
        skipExerciseBtn.classList.add('hidden');
        restTimer.classList.remove('hidden');
        
        restTimeDisplay.textContent = state.restSecondsRemaining;
        
        if (restInterval) clearInterval(restInterval);
        
        restInterval = setInterval(() => {
          state.restSecondsRemaining--;
          restTimeDisplay.textContent = state.restSecondsRemaining;
          
          if (state.restSecondsRemaining <= 3 && state.restSecondsRemaining > 0) {
            playBeep(600, 150);
          }
          
          if (state.restSecondsRemaining <= 0) {
            clearInterval(restInterval);
            endRestTimer();
            playBeep(1000, 300);
          }
        }, 1000);
      }

      function endRestTimer() {
        state.restTimerActive = false;
        restTimer.classList.add('hidden');
        repsInput.classList.remove('hidden');
        completeExerciseBtn.classList.remove('hidden');
        skipExerciseBtn.classList.remove('hidden');
        
        state.currentExerciseIndex++;
        displayCurrentExercise();
      }

      // Stop workout
      function stopWorkout() {
        if (!confirm('Are you sure you want to end this workout?')) return;
        
        if (restInterval) clearInterval(restInterval);
        
        state.workoutInProgress = false;
        activeWorkout.classList.add('hidden');
        workoutStatus.classList.remove('hidden');
        
        saveData();
      }

      // Finish workout
      function finishWorkout() {
        state.workoutInProgress = false;
        
        if (restInterval) clearInterval(restInterval);
        
        // Calculate stats
        const completed = state.workoutData.filter(ex => ex.completedReps !== null).length;
        const skipped = state.workoutData.filter(ex => ex.skipped).length;
        const totalReps = state.workoutData.reduce((sum, ex) => 
          sum + (ex.completedReps || 0), 0
        );

        // Check for progressions
        const progressions = [];
        state.workoutData.forEach(ex => {
          const exLevel = state.exerciseLevels[ex.exercise.id];
          if (exLevel.successCount === 1) {
            progressions.push(`${ex.exercise.name}: One more successful workout to level up!`);
          }
        });

        // Save workout to history
        state.history.push({
          date: new Date().toISOString(),
          exercises: state.workoutData.map(ex => ({
            id: ex.exercise.id,
            name: ex.exercise.name,
            level: ex.level,
            target: ex.targetReps,
            completed: ex.completedReps,
            skipped: ex.skipped
          })),
          totalReps,
          duration: null
        });

        saveData();
        updateStatsDisplay();

        // Display summary
        workoutSummary.innerHTML = `
          <div class="text-lg mb-2">Completed: ${completed}/${state.workoutData.length} exercises</div>
          <div class="text-sm">Total Reps: ${totalReps}</div>
          ${skipped > 0 ? `<div class="text-sm text-slate-400">Skipped: ${skipped}</div>` : ''}
        `;

        if (progressions.length > 0) {
          progressionAdvice.innerHTML = `
            <div class="font-bold mb-2 text-blue-400">🎯 Progress Update:</div>
            ${progressions.map(p => `<div class="text-sm">• ${p}</div>`).join('')}
          `;
        } else {
          progressionAdvice.innerHTML = `
            <div class="font-bold mb-2 text-blue-400">💪 Keep Training!</div>
            <div class="text-sm">Complete target reps for 2 consecutive workouts to level up exercises.</div>
          `;
        }

        activeWorkout.classList.add('hidden');
        workoutComplete.classList.remove('hidden');
        
        playBeep(1500, 500);
        scrollToTop();
      }

      // Finish button
      finishBtn.addEventListener('click', () => {
        workoutComplete.classList.add('hidden');
        workoutStatus.classList.remove('hidden');
      });

      // Show history
      function showHistory() {
        const sortedHistory = [...state.history].reverse();
        
        if (sortedHistory.length === 0) {
          historyList.innerHTML = '<div class="text-slate-400 text-center py-8">No workout history yet</div>';
          return;
        }

        historyList.innerHTML = sortedHistory.map((workout, idx) => {
          const date = new Date(workout.date);
          const dateStr = date.toLocaleDateString(undefined, {
            weekday: 'short',
            month: 'short',
            day: 'numeric',
            year: 'numeric'
          });
          
          const completed = workout.exercises.filter(ex => ex.completed !== null).length;
          
          return `
            <div class="bg-slate-900/50 border border-blue-500/30 rounded p-4">
              <div class="flex justify-between items-start mb-2">
                <div>
                  <div class="font-bold text-blue-400">${dateStr}</div>
                  <div class="text-sm text-slate-400">${completed}/${workout.exercises.length} exercises • ${workout.totalReps} reps</div>
                </div>
                <button 
                  onclick="deleteWorkout(${state.history.length - 1 - idx})" 
                  class="text-red-400 hover:text-red-300 text-sm"
                  title="Delete"
                >
                  ×
                </button>
              </div>
              <div class="space-y-1 text-xs">
                ${workout.exercises.map(ex => {
                  if (ex.skipped) return `<div class="text-slate-500">⊘ ${ex.name}</div>`;
                  return `<div class="text-slate-300">✓ ${ex.name}: ${ex.completed}/${ex.target}</div>`;
                }).join('')}
              </div>
            </div>
          `;
        }).join('');
      }

      // Delete workout
      window.deleteWorkout = function(index) {
        if (!confirm('Delete this workout?')) return;
        state.history.splice(index, 1);
        saveData();
        updateStatsDisplay();
        showHistory();
      };

      // Setup event listeners
      function setupEventListeners() {
        startWorkoutBtn.addEventListener('click', startWorkout);
        completeExerciseBtn.addEventListener('click', completeExercise);
        skipExerciseBtn.addEventListener('click', skipExercise);
        stopWorkoutBtn.addEventListener('click', stopWorkout);

        // Enter key on reps input
        repsInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') completeExercise();
        });

        // Modals
        infoBtn.addEventListener('click', () => infoModal.classList.remove('hidden'));
        closeInfo.addEventListener('click', () => infoModal.classList.add('hidden'));
        
        historyBtn.addEventListener('click', () => {
          showHistory();
          historyModal.classList.remove('hidden');
        });
        closeHistory.addEventListener('click', () => historyModal.classList.add('hidden'));
        
        settingsBtn.addEventListener('click', () => settingsModal.classList.remove('hidden'));
        closeSettings.addEventListener('click', () => {
          state.settings.restTime = parseInt(restTimeSetting.value);
          state.settings.soundEnabled = soundAlerts.checked;
          saveData();
          settingsModal.classList.add('hidden');
        });

        // Close modals on backdrop click
        [infoModal, historyModal, settingsModal].forEach(modal => {
          modal.addEventListener('click', (e) => {
            if (e.target === modal) {
              modal.classList.add('hidden');
            }
          });
        });

        // Reset progress
        resetProgress.addEventListener('click', () => {
          if (!confirm('Are you sure you want to reset ALL progress? This cannot be undone!')) return;
          if (!confirm('Really reset? All workout history and levels will be lost!')) return;
          
          EXERCISES.forEach(ex => {
            state.exerciseLevels[ex.id] = { level: 1, successCount: 0 };
          });
          state.history = [];
          saveData();
          updateStatsDisplay();
          settingsModal.classList.add('hidden');
          alert('Progress reset complete');
        });
      }

      // Dark mode
      document.documentElement.classList.add('dark');

      // Initialize app
      init();
    </script>
  </body>
</html>
