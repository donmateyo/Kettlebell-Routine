<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <title>Progressive Bodyweight Workout</title>
    <meta
      name="description"
      content="Progressive bodyweight workout app with proven exercises for full-body training"
    />
    <meta name="theme-color" content="#0a0a0a" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="apple-mobile-web-app-title" content="BW Workout" />

    <script>
      // Generate icon
      (function generateIconsAndManifest() {
        function drawIcon(size) {
          const c = document.createElement("canvas");
          c.width = c.height = size;
          const ctx = c.getContext("2d");

          // Gradient background
          const g = ctx.createLinearGradient(0, 0, size, size);
          g.addColorStop(0, "#6366f1");
          g.addColorStop(0.5, "#8b5cf6");
          g.addColorStop(1, "#d946ef");
          ctx.fillStyle = g;
          ctx.fillRect(0, 0, size, size);

          // Muscle icon (simple representation)
          ctx.save();
          const s = size / 512;
          ctx.scale(s, s);

          // Glow effect
          ctx.shadowColor = "rgba(139, 92, 246, 0.8)";
          ctx.shadowBlur = 40;
          
          // Draw stylized person doing push-up
          ctx.fillStyle = "#fff";
          ctx.strokeStyle = "#fff";
          ctx.lineWidth = 20;
          ctx.lineCap = "round";
          ctx.lineJoin = "round";

          // Body
          ctx.beginPath();
          ctx.arc(200, 180, 40, 0, Math.PI * 2); // Head
          ctx.fill();
          
          // Arms and body
          ctx.beginPath();
          ctx.moveTo(200, 220);
          ctx.lineTo(200, 320);
          ctx.lineTo(120, 380);
          ctx.moveTo(200, 320);
          ctx.lineTo(280, 380);
          ctx.moveTo(200, 240);
          ctx.lineTo(120, 280);
          ctx.moveTo(200, 240);
          ctx.lineTo(280, 280);
          ctx.stroke();

          ctx.restore();
          return c.toDataURL("image/png");
        }

        const icon180 = drawIcon(180);
        const icon192 = drawIcon(192);
        const icon512 = drawIcon(512);

        const apple = document.createElement("link");
        apple.rel = "apple-touch-icon";
        apple.href = icon180;
        document.head.appendChild(apple);

        const fav = document.createElement("link");
        fav.rel = "icon";
        fav.type = "image/png";
        fav.href = icon192;
        document.head.appendChild(fav);

        const manifest = {
          name: "Progressive Bodyweight Workout",
          short_name: "BW Workout",
          start_url: "/",
          scope: "/",
          display: "standalone",
          background_color: "#0a0a0a",
          theme_color: "#8b5cf6",
          description: "Progressive bodyweight workout app with proven exercises",
          icons: [
            { src: icon192, sizes: "192x192", type: "image/png" },
            { src: icon512, sizes: "512x512", type: "image/png", purpose: "any maskable" }
          ]
        };

        const blob = new Blob([JSON.stringify(manifest)], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const link = document.createElement("link");
        link.rel = "manifest";
        link.href = url;
        document.head.appendChild(link);
      })();
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = { darkMode: "class" };
    </script>

    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');

      :root {
        color-scheme: dark;
      }

      * {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      }

      input, select, textarea {
        font-size: 16px !important;
      }

      body {
        background: #0a0a0a;
        background-image: 
          radial-gradient(at 0% 0%, rgba(99, 102, 241, 0.15) 0px, transparent 50%),
          radial-gradient(at 100% 100%, rgba(217, 70, 239, 0.15) 0px, transparent 50%);
        background-attachment: fixed;
        min-height: 100vh;
      }

      .glass-card {
        background: rgba(20, 20, 20, 0.8);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.05);
        box-shadow: 
          0 8px 32px rgba(0, 0, 0, 0.5),
          inset 0 1px 0 rgba(255, 255, 255, 0.05);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .glass-card:hover {
        border-color: rgba(139, 92, 246, 0.3);
        box-shadow: 
          0 12px 40px rgba(139, 92, 246, 0.2),
          inset 0 1px 0 rgba(255, 255, 255, 0.08);
        transform: translateY(-2px);
      }

      .glass-card-active {
        border-color: rgba(139, 92, 246, 0.5);
        box-shadow: 
          0 0 0 1px rgba(139, 92, 246, 0.3),
          0 20px 60px rgba(139, 92, 246, 0.3);
      }

      .btn-gradient {
        background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #d946ef 100%);
        background-size: 200% 200%;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
      }

      .btn-gradient::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, transparent, rgba(255,255,255,0.1), transparent);
        transform: translateX(-100%);
        transition: transform 0.6s;
      }

      .btn-gradient:hover {
        background-position: 100% 0;
        transform: translateY(-2px);
        box-shadow: 0 12px 40px rgba(139, 92, 246, 0.5);
      }

      .btn-gradient:hover::before {
        transform: translateX(100%);
      }

      .btn-gradient:active {
        transform: translateY(0);
      }

      .set-indicator {
        transition: all 0.3s ease;
      }

      .set-complete {
        background: linear-gradient(135deg, rgba(34, 197, 94, 0.3), rgba(22, 163, 74, 0.3));
        border-color: #22c55e;
      }

      .progress-ring {
        transition: stroke-dashoffset 0.5s ease;
      }

      @keyframes shimmer {
        0%, 100% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
      }

      .shimmer {
        animation: shimmer 3s ease infinite;
        background: linear-gradient(90deg, 
          rgba(99, 102, 241, 0.1) 0%, 
          rgba(139, 92, 246, 0.2) 50%, 
          rgba(99, 102, 241, 0.1) 100%);
        background-size: 200% 100%;
      }

      .timer-display {
        font-variant-numeric: tabular-nums;
        font-feature-settings: "tnum";
      }

      input, select, textarea {
        background: rgba(20, 20, 20, 0.8) !important;
        border: 1px solid rgba(139, 92, 246, 0.2) !important;
        color: #f1f5f9 !important;
        transition: all 0.2s ease !important;
      }

      input:focus, select:focus, textarea:focus {
        outline: none !important;
        border-color: rgba(139, 92, 246, 0.5) !important;
        box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1) !important;
      }

      .stat-card {
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.05));
        border: 1px solid rgba(139, 92, 246, 0.2);
      }

      @media all and (display-mode: standalone) {
        body {
          padding-top: env(safe-area-inset-top);
          padding-bottom: env(safe-area-inset-bottom);
        }
      }

      /* Scrollbar styling */
      ::-webkit-scrollbar {
        width: 8px;
      }

      ::-webkit-scrollbar-track {
        background: rgba(20, 20, 20, 0.5);
      }

      ::-webkit-scrollbar-thumb {
        background: rgba(139, 92, 246, 0.3);
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: rgba(139, 92, 246, 0.5);
      }
    </style>
  </head>

  <body class="text-slate-100 min-h-screen antialiased">
    <div id="app" class="max-w-3xl mx-auto pb-24 px-4">
      <!-- Header -->
      <header class="sticky top-0 z-50 pt-6 pb-4 mb-6">
        <div class="glass-card rounded-2xl p-6">
          <div class="flex items-center justify-between">
            <div>
              <h1 class="text-3xl font-bold tracking-tight bg-gradient-to-r from-indigo-400 via-purple-400 to-pink-400 bg-clip-text text-transparent">
                BODYWEIGHT
              </h1>
              <p class="text-sm text-slate-400 mt-1 font-medium">Progressive Training System</p>
            </div>
            
            <div class="flex gap-2">
              <button
                id="infoBtn"
                class="glass-card p-2.5 rounded-xl hover:bg-purple-500/10 transition-all"
                title="Info"
              >
                <svg class="w-5 h-5 text-purple-400" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                </svg>
              </button>
              <button
                id="historyBtn"
                class="glass-card p-2.5 rounded-xl hover:bg-purple-500/10 transition-all"
                title="History"
              >
                <svg class="w-5 h-5 text-purple-400" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                  <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"/>
                </svg>
              </button>
              <button
                id="settingsBtn"
                class="glass-card p-2.5 rounded-xl hover:bg-purple-500/10 transition-all"
                title="Settings"
              >
                <svg class="w-5 h-5 text-purple-400" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"/>
                </svg>
              </button>
            </div>
          </div>
        </div>
      </header>

      <!-- Main Content -->
      <main class="space-y-6">
        <!-- Stats Dashboard -->
        <div class="glass-card rounded-2xl p-6">
          <h3 class="text-xs font-bold text-purple-400 uppercase tracking-wider mb-4">Performance</h3>
          <div class="grid grid-cols-3 gap-4">
            <div class="stat-card p-4 rounded-xl text-center">
              <div class="text-slate-400 text-xs font-semibold uppercase tracking-wide">Total</div>
              <div id="totalWorkouts" class="text-3xl font-bold text-transparent bg-gradient-to-br from-purple-400 to-pink-400 bg-clip-text mt-2">0</div>
              <div class="text-xs text-slate-500 mt-1">Workouts</div>
            </div>
            <div class="stat-card p-4 rounded-xl text-center">
              <div class="text-slate-400 text-xs font-semibold uppercase tracking-wide">Week</div>
              <div id="weekWorkouts" class="text-3xl font-bold text-transparent bg-gradient-to-br from-indigo-400 to-purple-400 bg-clip-text mt-2">0/3</div>
              <div class="text-xs text-slate-500 mt-1">Complete</div>
            </div>
            <div class="stat-card p-4 rounded-xl text-center">
              <div class="text-slate-400 text-xs font-semibold uppercase tracking-wide">Level</div>
              <div id="currentLevel" class="text-3xl font-bold text-transparent bg-gradient-to-br from-pink-400 to-rose-400 bg-clip-text mt-2">1</div>
              <div class="text-xs text-slate-500 mt-1">Average</div>
            </div>
          </div>
        </div>

        <!-- Workout Status -->
        <div id="workoutStatus" class="glass-card rounded-2xl p-8 text-center shimmer">
          <div class="inline-block px-4 py-1.5 bg-purple-500/20 rounded-full mb-4">
            <span class="text-xs font-bold text-purple-400 uppercase tracking-wider">Ready to Train</span>
          </div>
          <div class="text-4xl font-black mb-2 bg-gradient-to-r from-indigo-400 via-purple-400 to-pink-400 bg-clip-text text-transparent">
            FULL BODY
          </div>
          <div class="text-slate-400 mb-6 font-medium">7 exercises â€¢ 3 sets each â€¢ Progressive difficulty</div>
          <button
            id="startWorkoutBtn"
            class="btn-gradient w-full py-4 text-lg font-bold uppercase tracking-wider rounded-xl shadow-2xl"
          >
            Start Training
          </button>
        </div>

        <!-- Active Workout View -->
        <div id="activeWorkout" class="hidden space-y-6">
          <!-- Current Exercise Card -->
          <div id="currentExerciseCard" class="glass-card glass-card-active rounded-2xl p-8">
            <div class="flex justify-between items-start mb-6">
              <div class="flex-1">
                <div class="inline-block px-3 py-1 bg-purple-500/20 rounded-full mb-3">
                  <span class="text-xs font-bold text-purple-400 uppercase tracking-wider">Current</span>
                </div>
                <h2 id="exerciseName" class="text-3xl font-black mb-2 text-white">Push-ups</h2>
                <p id="exerciseLevel" class="text-sm text-slate-400 font-medium">Level 1: Standard</p>
              </div>
              <div class="text-right">
                <div class="text-xs text-slate-500 uppercase font-semibold tracking-wide">Exercise</div>
                <div id="exerciseNumber" class="text-3xl font-bold text-transparent bg-gradient-to-br from-purple-400 to-pink-400 bg-clip-text">1/7</div>
              </div>
            </div>

            <!-- Set Indicator -->
            <div class="mb-6">
              <div class="text-xs text-slate-400 uppercase font-semibold tracking-wide mb-3">Current Set</div>
              <div id="setIndicators" class="flex gap-3 justify-center"></div>
            </div>
            
            <div class="mb-6">
              <div class="text-sm text-slate-400 mb-2 font-semibold">Target Reps</div>
              <div id="targetReps" class="text-6xl font-black text-transparent bg-gradient-to-br from-indigo-400 via-purple-400 to-pink-400 bg-clip-text">12</div>
            </div>

            <div class="mb-6">
              <label class="block text-sm text-slate-400 mb-3 font-semibold">Reps Completed</label>
              <input
                id="repsInput"
                type="number"
                min="0"
                class="w-full px-6 py-4 text-3xl font-bold text-center rounded-xl"
                placeholder="0"
              />
            </div>

            <!-- Rest Timer -->
            <div id="restTimer" class="hidden mb-6 text-center p-8 glass-card rounded-2xl">
              <div class="text-sm text-slate-400 mb-4 font-semibold uppercase tracking-wide">Rest Period</div>
              <div id="restTimeDisplay" class="text-7xl font-black text-transparent bg-gradient-to-br from-indigo-400 to-purple-400 bg-clip-text timer-display mb-2">90</div>
              <div class="text-xs text-slate-500 uppercase tracking-wide font-semibold">seconds remaining</div>
            </div>

            <div class="grid grid-cols-2 gap-4">
              <button
                id="completeSetBtn"
                class="btn-gradient py-4 font-bold uppercase rounded-xl text-sm tracking-wider"
              >
                Complete Set
              </button>
              <button
                id="skipSetBtn"
                class="glass-card hover:bg-red-500/20 py-4 font-bold uppercase rounded-xl transition-all text-sm tracking-wider"
              >
                Skip Set
              </button>
            </div>
          </div>

          <!-- Progress Overview -->
          <div class="glass-card rounded-2xl p-6">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-xs font-bold text-purple-400 uppercase tracking-wider">Workout Progress</h3>
              <span id="progressPercentage" class="text-sm font-bold text-purple-400">0%</span>
            </div>
            <div class="bg-black/40 rounded-full h-2.5 mb-6 overflow-hidden">
              <div id="progressBar" class="bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 h-full rounded-full transition-all duration-500 ease-out" style="width: 0%"></div>
            </div>
            <div id="exerciseList" class="space-y-3"></div>
          </div>

          <button
            id="stopWorkoutBtn"
            class="w-full glass-card bg-red-900/20 hover:bg-red-900/40 border-red-500/30 py-4 font-bold uppercase rounded-xl transition-all text-sm tracking-wider"
          >
            End Workout Early
          </button>
        </div>

        <!-- Workout Complete View -->
        <div id="workoutComplete" class="hidden glass-card rounded-2xl p-8 text-center">
          <div class="text-6xl mb-4">ðŸŽ‰</div>
          <div class="text-4xl font-black mb-3 bg-gradient-to-r from-indigo-400 via-purple-400 to-pink-400 bg-clip-text text-transparent">
            Workout Complete!
          </div>
          <div id="workoutSummary" class="text-slate-400 mb-6 font-medium"></div>
          <div id="progressionAdvice" class="glass-card rounded-xl p-6 mb-6 text-sm"></div>
          <button
            id="finishBtn"
            class="btn-gradient w-full py-4 font-bold uppercase rounded-xl text-sm tracking-wider"
          >
            Finish & Return
          </button>
        </div>
      </main>

      <!-- Info Modal -->
      <div id="infoModal" class="fixed inset-0 bg-black/90 backdrop-blur-md hidden z-50 flex items-center justify-center p-4">
        <div class="glass-card w-full max-w-lg p-8 max-h-[85vh] overflow-y-auto rounded-2xl">
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold text-transparent bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text">Workout Info</h2>
            <button id="closeInfo" class="glass-card p-2 rounded-xl hover:bg-red-500/20 transition-all">
              <svg class="w-5 h-5 text-slate-400" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
              </svg>
            </button>
          </div>

          <div class="space-y-5 text-sm">
            <div class="glass-card p-5 rounded-xl">
              <h3 class="font-bold text-purple-400 mb-3 text-base">Program Overview</h3>
              <p class="text-slate-300 leading-relaxed">
                A progressive full-body bodyweight routine designed for 3x per week training. 
                Each exercise is performed for 3 sets, with progressive overload to build strength and muscle.
              </p>
            </div>

            <div class="glass-card p-5 rounded-xl">
              <h3 class="font-bold text-purple-400 mb-3 text-base">Exercises (3 Sets Each)</h3>
              <ul class="space-y-2 text-slate-300">
                <li class="flex items-start">
                  <span class="text-purple-400 mr-2">â€¢</span>
                  <span><strong>Push-ups:</strong> Chest, shoulders, triceps</span>
                </li>
                <li class="flex items-start">
                  <span class="text-purple-400 mr-2">â€¢</span>
                  <span><strong>Squats:</strong> Legs, glutes</span>
                </li>
                <li class="flex items-start">
                  <span class="text-purple-400 mr-2">â€¢</span>
                  <span><strong>Dips:</strong> Triceps, chest</span>
                </li>
                <li class="flex items-start">
                  <span class="text-purple-400 mr-2">â€¢</span>
                  <span><strong>Rows:</strong> Back, biceps</span>
                </li>
                <li class="flex items-start">
                  <span class="text-purple-400 mr-2">â€¢</span>
                  <span><strong>Pike Push-ups:</strong> Shoulders</span>
                </li>
                <li class="flex items-start">
                  <span class="text-purple-400 mr-2">â€¢</span>
                  <span><strong>Leg Raises:</strong> Core</span>
                </li>
                <li class="flex items-start">
                  <span class="text-purple-400 mr-2">â€¢</span>
                  <span><strong>Plank:</strong> Core stability</span>
                </li>
              </ul>
            </div>

            <div class="glass-card p-5 rounded-xl">
              <h3 class="font-bold text-purple-400 mb-3 text-base">Progression System</h3>
              <ul class="space-y-2 text-slate-300">
                <li class="flex items-start">
                  <span class="text-purple-400 mr-2">âœ“</span>
                  <span>Complete all 3 sets with target reps for 2 consecutive workouts to progress</span>
                </li>
                <li class="flex items-start">
                  <span class="text-purple-400 mr-2">âœ“</span>
                  <span>Each level increases difficulty with more reps or harder variations</span>
                </li>
                <li class="flex items-start">
                  <span class="text-purple-400 mr-2">âœ“</span>
                  <span>Track your performance to see improvements over time</span>
                </li>
              </ul>
            </div>

            <div class="glass-card p-5 rounded-xl">
              <h3 class="font-bold text-purple-400 mb-3 text-base">Training Tips</h3>
              <ul class="space-y-2 text-slate-300">
                <li class="flex items-start">
                  <span class="text-pink-400 mr-2">â†’</span>
                  <span>Focus on proper form over reps</span>
                </li>
                <li class="flex items-start">
                  <span class="text-pink-400 mr-2">â†’</span>
                  <span>Rest 90-120 seconds between sets</span>
                </li>
                <li class="flex items-start">
                  <span class="text-pink-400 mr-2">â†’</span>
                  <span>Train 3x per week with rest days between</span>
                </li>
                <li class="flex items-start">
                  <span class="text-pink-400 mr-2">â†’</span>
                  <span>Stay consistent for best results</span>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- History Modal -->
      <div id="historyModal" class="fixed inset-0 bg-black/90 backdrop-blur-md hidden z-50 flex items-center justify-center p-4">
        <div class="glass-card w-full max-w-lg p-8 max-h-[85vh] overflow-y-auto rounded-2xl">
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold text-transparent bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text">Workout History</h2>
            <button id="closeHistory" class="glass-card p-2 rounded-xl hover:bg-red-500/20 transition-all">
              <svg class="w-5 h-5 text-slate-400" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
              </svg>
            </button>
          </div>

          <div id="historyList" class="space-y-4"></div>
        </div>
      </div>

      <!-- Settings Modal -->
      <div id="settingsModal" class="fixed inset-0 bg-black/90 backdrop-blur-md hidden z-50 flex items-center justify-center p-4">
        <div class="glass-card w-full max-w-md p-8 rounded-2xl">
          <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold text-transparent bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text">Settings</h2>
            <button id="closeSettings" class="glass-card p-2 rounded-xl hover:bg-red-500/20 transition-all">
              <svg class="w-5 h-5 text-slate-400" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
              </svg>
            </button>
          </div>

          <div class="space-y-5">
            <div class="glass-card p-5 rounded-xl">
              <label class="block text-sm font-semibold mb-3 text-purple-400">
                Rest Time Between Sets
              </label>
              <input
                type="number"
                id="restTimeSetting"
                min="30"
                max="300"
                step="10"
                value="90"
                class="w-full px-4 py-3 rounded-xl font-semibold"
              />
              <p class="text-xs text-slate-500 mt-2">Recommended: 90-120 seconds</p>
            </div>

            <div class="glass-card p-5 rounded-xl">
              <label class="flex items-center cursor-pointer">
                <input
                  type="checkbox"
                  id="soundAlerts"
                  class="mr-3 w-5 h-5 cursor-pointer accent-purple-500"
                  checked
                />
                <span class="font-semibold">Enable sound alerts</span>
              </label>
            </div>

            <button
              id="resetProgress"
              class="w-full glass-card bg-red-900/20 hover:bg-red-900/40 border-red-500/30 py-4 font-bold uppercase rounded-xl transition-all text-sm tracking-wider"
            >
              Reset All Progress
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Exercise Database with Progressive Levels (Pull-ups removed)
      const EXERCISES = [
        {
          id: 'pushups',
          name: 'Push-ups',
          category: 'Push',
          levels: [
            { level: 1, name: 'Standard Push-ups', reps: 12 },
            { level: 2, name: 'Standard Push-ups', reps: 15 },
            { level: 3, name: 'Standard Push-ups', reps: 20 },
            { level: 4, name: 'Diamond Push-ups', reps: 12 },
            { level: 5, name: 'Diamond Push-ups', reps: 15 },
            { level: 6, name: 'Archer Push-ups', reps: 10 },
            { level: 7, name: 'Archer Push-ups', reps: 12 },
            { level: 8, name: 'One-Arm Push-up Progression', reps: 8 }
          ]
        },
        {
          id: 'squats',
          name: 'Squats',
          category: 'Legs',
          levels: [
            { level: 1, name: 'Bodyweight Squats', reps: 15 },
            { level: 2, name: 'Bodyweight Squats', reps: 20 },
            { level: 3, name: 'Bodyweight Squats', reps: 25 },
            { level: 4, name: 'Jump Squats', reps: 15 },
            { level: 5, name: 'Bulgarian Split Squats', reps: 12 },
            { level: 6, name: 'Pistol Squat Progression', reps: 8 },
            { level: 7, name: 'Pistol Squats', reps: 8 },
            { level: 8, name: 'Pistol Squats', reps: 10 }
          ]
        },
        {
          id: 'dips',
          name: 'Dips',
          category: 'Push',
          levels: [
            { level: 1, name: 'Bench Dips', reps: 12 },
            { level: 2, name: 'Bench Dips', reps: 15 },
            { level: 3, name: 'Parallel Bar Dips', reps: 8 },
            { level: 4, name: 'Parallel Bar Dips', reps: 10 },
            { level: 5, name: 'Parallel Bar Dips', reps: 12 },
            { level: 6, name: 'Ring Dips', reps: 8 },
            { level: 7, name: 'Weighted Dips', reps: 10 },
            { level: 8, name: 'Weighted Dips', reps: 12 }
          ]
        },
        {
          id: 'rows',
          name: 'Rows',
          category: 'Pull',
          levels: [
            { level: 1, name: 'Incline Rows', reps: 12 },
            { level: 2, name: 'Incline Rows', reps: 15 },
            { level: 3, name: 'Horizontal Rows', reps: 10 },
            { level: 4, name: 'Horizontal Rows', reps: 12 },
            { level: 5, name: 'Horizontal Rows', reps: 15 },
            { level: 6, name: 'Archer Rows', reps: 10 },
            { level: 7, name: 'One-Arm Row Progression', reps: 8 },
            { level: 8, name: 'One-Arm Rows', reps: 10 }
          ]
        },
        {
          id: 'pike_pushups',
          name: 'Pike Push-ups',
          category: 'Push',
          levels: [
            { level: 1, name: 'Pike Push-ups', reps: 10 },
            { level: 2, name: 'Pike Push-ups', reps: 12 },
            { level: 3, name: 'Pike Push-ups', reps: 15 },
            { level: 4, name: 'Elevated Pike Push-ups', reps: 10 },
            { level: 5, name: 'Elevated Pike Push-ups', reps: 12 },
            { level: 6, name: 'Wall Handstand Push-up Progression', reps: 8 },
            { level: 7, name: 'Handstand Push-ups (Wall)', reps: 5 },
            { level: 8, name: 'Handstand Push-ups (Wall)', reps: 8 }
          ]
        },
        {
          id: 'leg_raises',
          name: 'Leg Raises',
          category: 'Core',
          levels: [
            { level: 1, name: 'Knee Raises', reps: 12 },
            { level: 2, name: 'Knee Raises', reps: 15 },
            { level: 3, name: 'Straight Leg Raises', reps: 10 },
            { level: 4, name: 'Straight Leg Raises', reps: 12 },
            { level: 5, name: 'Straight Leg Raises', reps: 15 },
            { level: 6, name: 'Hanging Leg Raises', reps: 10 },
            { level: 7, name: 'Toes to Bar', reps: 8 },
            { level: 8, name: 'Toes to Bar', reps: 12 }
          ]
        },
        {
          id: 'plank',
          name: 'Plank',
          category: 'Core',
          levels: [
            { level: 1, name: 'Plank', reps: 30 },
            { level: 2, name: 'Plank', reps: 45 },
            { level: 3, name: 'Plank', reps: 60 },
            { level: 4, name: 'Plank', reps: 75 },
            { level: 5, name: 'Plank', reps: 90 },
            { level: 6, name: 'Plank', reps: 120 },
            { level: 7, name: 'Weighted Plank', reps: 60 },
            { level: 8, name: 'Weighted Plank', reps: 90 }
          ]
        }
      ];

      const SETS_PER_EXERCISE = 3;

      // State
      let state = {
        workoutInProgress: false,
        currentExerciseIndex: 0,
        currentSet: 1,
        workoutData: [],
        exerciseLevels: {},
        settings: {
          restTime: 90,
          soundEnabled: true
        },
        history: [],
        restTimerActive: false,
        restSecondsRemaining: 0
      };

      let restInterval = null;
      let audioContext = null;

      // Storage keys
      const STORAGE_KEYS = {
        LEVELS: 'bw_exercise_levels_v2',
        HISTORY: 'bw_workout_history_v2',
        SETTINGS: 'bw_settings'
      };

      // Elements
      const startWorkoutBtn = document.getElementById('startWorkoutBtn');
      const workoutStatus = document.getElementById('workoutStatus');
      const activeWorkout = document.getElementById('activeWorkout');
      const workoutComplete = document.getElementById('workoutComplete');
      const currentExerciseCard = document.getElementById('currentExerciseCard');
      const exerciseName = document.getElementById('exerciseName');
      const exerciseLevel = document.getElementById('exerciseLevel');
      const exerciseNumber = document.getElementById('exerciseNumber');
      const targetReps = document.getElementById('targetReps');
      const repsInput = document.getElementById('repsInput');
      const completeSetBtn = document.getElementById('completeSetBtn');
      const skipSetBtn = document.getElementById('skipSetBtn');
      const stopWorkoutBtn = document.getElementById('stopWorkoutBtn');
      const progressBar = document.getElementById('progressBar');
      const progressPercentage = document.getElementById('progressPercentage');
      const exerciseList = document.getElementById('exerciseList');
      const restTimer = document.getElementById('restTimer');
      const restTimeDisplay = document.getElementById('restTimeDisplay');
      const finishBtn = document.getElementById('finishBtn');
      const workoutSummary = document.getElementById('workoutSummary');
      const progressionAdvice = document.getElementById('progressionAdvice');
      const setIndicators = document.getElementById('setIndicators');

      // Stats
      const totalWorkouts = document.getElementById('totalWorkouts');
      const weekWorkouts = document.getElementById('weekWorkouts');
      const currentLevel = document.getElementById('currentLevel');

      // Modals
      const infoModal = document.getElementById('infoModal');
      const historyModal = document.getElementById('historyModal');
      const settingsModal = document.getElementById('settingsModal');
      const infoBtn = document.getElementById('infoBtn');
      const historyBtn = document.getElementById('historyBtn');
      const settingsBtn = document.getElementById('settingsBtn');
      const closeInfo = document.getElementById('closeInfo');
      const closeHistory = document.getElementById('closeHistory');
      const closeSettings = document.getElementById('closeSettings');
      const historyList = document.getElementById('historyList');
      const restTimeSetting = document.getElementById('restTimeSetting');
      const soundAlerts = document.getElementById('soundAlerts');
      const resetProgress = document.getElementById('resetProgress');

      // Initialize
      function init() {
        loadData();
        updateStatsDisplay();
        setupEventListeners();
      }

      // Load saved data
      function loadData() {
        try {
          const savedLevels = localStorage.getItem(STORAGE_KEYS.LEVELS);
          if (savedLevels) {
            state.exerciseLevels = JSON.parse(savedLevels);
          } else {
            // Initialize all exercises at level 1
            EXERCISES.forEach(ex => {
              state.exerciseLevels[ex.id] = { level: 1, successCount: 0 };
            });
          }

          const savedHistory = localStorage.getItem(STORAGE_KEYS.HISTORY);
          if (savedHistory) {
            state.history = JSON.parse(savedHistory);
          }

          const savedSettings = localStorage.getItem(STORAGE_KEYS.SETTINGS);
          if (savedSettings) {
            state.settings = JSON.parse(savedSettings);
            restTimeSetting.value = state.settings.restTime;
            soundAlerts.checked = state.settings.soundEnabled;
          }
        } catch (error) {
          console.error('Error loading data:', error);
        }
      }

      // Save data
      function saveData() {
        try {
          localStorage.setItem(STORAGE_KEYS.LEVELS, JSON.stringify(state.exerciseLevels));
          localStorage.setItem(STORAGE_KEYS.HISTORY, JSON.stringify(state.history));
          localStorage.setItem(STORAGE_KEYS.SETTINGS, JSON.stringify(state.settings));
        } catch (error) {
          console.error('Error saving data:', error);
        }
      }

      // Update stats display
      function updateStatsDisplay() {
        totalWorkouts.textContent = state.history.length;
        
        // Count this week's workouts
        const now = new Date();
        const weekStart = new Date(now);
        weekStart.setDate(now.getDate() - now.getDay());
        weekStart.setHours(0, 0, 0, 0);
        
        const thisWeek = state.history.filter(w => new Date(w.date) >= weekStart).length;
        weekWorkouts.textContent = `${thisWeek}/3`;

        // Calculate average level
        const avgLevel = Math.round(
          Object.values(state.exerciseLevels).reduce((sum, ex) => sum + ex.level, 0) / 
          EXERCISES.length
        );
        currentLevel.textContent = avgLevel;
      }

      // Audio
      function initAudio() {
        if (!audioContext) {
          audioContext = new (window.AudioContext || window.webkitAudioContext)();
        }
      }

      function playBeep(frequency = 800, duration = 200) {
        if (!state.settings.soundEnabled || !audioContext) return;
        const osc = audioContext.createOscillator();
        const gain = audioContext.createGain();
        osc.connect(gain);
        gain.connect(audioContext.destination);
        osc.frequency.value = frequency;
        osc.type = 'sine';
        gain.gain.setValueAtTime(0.1, audioContext.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration / 1000);
        osc.start(audioContext.currentTime);
        osc.stop(audioContext.currentTime + duration / 1000);
      }

      // Start workout
      function startWorkout() {
        initAudio();
        state.workoutInProgress = true;
        state.currentExerciseIndex = 0;
        state.currentSet = 1;
        state.workoutData = EXERCISES.map(ex => {
          const levelData = state.exerciseLevels[ex.id] || { level: 1 };
          const exerciseLevel = ex.levels[levelData.level - 1];
          return {
            exercise: ex,
            level: levelData.level,
            targetReps: exerciseLevel.reps,
            sets: [
              { reps: null, skipped: false },
              { reps: null, skipped: false },
              { reps: null, skipped: false }
            ]
          };
        });

        workoutStatus.classList.add('hidden');
        activeWorkout.classList.remove('hidden');
        
        displayCurrentExercise();
        updateExerciseList();
        playBeep(1000, 300);
      }

      // Display set indicators
      function displaySetIndicators() {
        const current = state.workoutData[state.currentExerciseIndex];
        setIndicators.innerHTML = current.sets.map((set, idx) => {
          const setNum = idx + 1;
          let classes = 'set-indicator w-20 h-20 rounded-xl flex flex-col items-center justify-center glass-card font-bold';
          let content = `<div class="text-xs text-slate-400 uppercase">Set</div><div class="text-2xl">${setNum}</div>`;
          
          if (set.reps !== null) {
            classes += ' set-complete';
            content = `<div class="text-xs text-green-400 uppercase">âœ“</div><div class="text-xl text-green-400">${set.reps}</div>`;
          } else if (set.skipped) {
            classes += ' opacity-50';
            content = `<div class="text-xs text-slate-500 uppercase">Skip</div><div class="text-xl text-slate-500">âŠ˜</div>`;
          } else if (setNum === state.currentSet) {
            classes += ' border-2 border-purple-400 bg-purple-500/20';
          }
          
          return `<div class="${classes}">${content}</div>`;
        }).join('');
      }

      // Display current exercise
      function displayCurrentExercise() {
        if (state.currentExerciseIndex >= state.workoutData.length) {
          finishWorkout();
          return;
        }

        const current = state.workoutData[state.currentExerciseIndex];
        const levelInfo = current.exercise.levels[current.level - 1];
        
        exerciseName.textContent = current.exercise.name;
        exerciseLevel.textContent = `Level ${current.level}: ${levelInfo.name}`;
        exerciseNumber.textContent = `${state.currentExerciseIndex + 1}/${state.workoutData.length}`;
        
        if (current.exercise.id === 'plank') {
          targetReps.textContent = `${current.targetReps}s`;
          repsInput.placeholder = 'Seconds held';
        } else {
          targetReps.textContent = current.targetReps;
          repsInput.placeholder = 'Reps completed';
        }
        
        repsInput.value = '';
        repsInput.focus();

        displaySetIndicators();
        updateProgress();
        scrollToTop();
      }

      function scrollToTop() {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }

      // Update progress
      function updateProgress() {
        const totalSets = state.workoutData.length * SETS_PER_EXERCISE;
        let completedSets = 0;
        
        state.workoutData.forEach(ex => {
          ex.sets.forEach(set => {
            if (set.reps !== null || set.skipped) {
              completedSets++;
            }
          });
        });
        
        const percentage = Math.round((completedSets / totalSets) * 100);
        
        progressBar.style.width = `${percentage}%`;
        progressPercentage.textContent = `${percentage}%`;
      }

      // Update exercise list
      function updateExerciseList() {
        exerciseList.innerHTML = state.workoutData.map((ex, idx) => {
          const completedSets = ex.sets.filter(s => s.reps !== null).length;
          const skippedSets = ex.sets.filter(s => s.skipped).length;
          const totalSets = ex.sets.length;
          
          let status = '';
          let statusClass = '';
          
          if (completedSets === totalSets) {
            status = `âœ“ Complete (${completedSets}/${totalSets})`;
            statusClass = 'text-green-400 font-semibold';
          } else if (idx === state.currentExerciseIndex) {
            status = `In Progress (${completedSets}/${totalSets})`;
            statusClass = 'text-purple-400 font-bold';
          } else if (completedSets > 0 || skippedSets > 0) {
            status = `${completedSets}/${totalSets} sets`;
            statusClass = 'text-slate-400';
          } else {
            status = `${totalSets} sets`;
            statusClass = 'text-slate-500';
          }

          return `
            <div class="flex justify-between items-center text-sm font-medium ${idx === state.currentExerciseIndex ? 'glass-card p-3 rounded-xl bg-purple-500/10' : 'p-2'}">
              <span class="${idx < state.currentExerciseIndex && completedSets === totalSets ? 'text-slate-400' : 'text-slate-200'}">${ex.exercise.name}</span>
              <span class="${statusClass}">${status}</span>
            </div>
          `;
        }).join('');
      }

      // Complete set
      function completeSet() {
        const reps = parseInt(repsInput.value);
        if (isNaN(reps) || reps < 0) {
          alert('Please enter a valid number of reps');
          return;
        }

        const current = state.workoutData[state.currentExerciseIndex];
        current.sets[state.currentSet - 1].reps = reps;

        saveData();
        displaySetIndicators();
        updateExerciseList();

        // Move to next set or exercise
        if (state.currentSet < SETS_PER_EXERCISE) {
          state.currentSet++;
          startRestTimer();
        } else {
          // Check for progression after all sets
          const allSetsComplete = current.sets.every(s => s.reps !== null && s.reps >= current.targetReps);
          
          if (allSetsComplete) {
            const exLevel = state.exerciseLevels[current.exercise.id];
            exLevel.successCount = (exLevel.successCount || 0) + 1;
            
            // Progress after 2 successful workouts
            if (exLevel.successCount >= 2 && exLevel.level < current.exercise.levels.length) {
              exLevel.level++;
              exLevel.successCount = 0;
            }
          } else {
            // Reset success count if didn't hit all targets
            state.exerciseLevels[current.exercise.id].successCount = 0;
          }

          saveData();
          
          // Move to next exercise
          state.currentExerciseIndex++;
          state.currentSet = 1;
          
          if (state.currentExerciseIndex < state.workoutData.length) {
            startRestTimer();
          } else {
            displayCurrentExercise();
          }
        }

        playBeep(1200, 200);
      }

      // Skip set
      function skipSet() {
        const current = state.workoutData[state.currentExerciseIndex];
        current.sets[state.currentSet - 1].skipped = true;
        
        // Reset success count
        state.exerciseLevels[current.exercise.id].successCount = 0;
        
        saveData();
        displaySetIndicators();
        updateExerciseList();

        // Move to next set or exercise
        if (state.currentSet < SETS_PER_EXERCISE) {
          state.currentSet++;
          displayCurrentExercise();
        } else {
          state.currentExerciseIndex++;
          state.currentSet = 1;
          displayCurrentExercise();
        }
      }

      // Rest timer
      function startRestTimer() {
        state.restTimerActive = true;
        state.restSecondsRemaining = state.settings.restTime;
        
        repsInput.classList.add('hidden');
        completeSetBtn.classList.add('hidden');
        skipSetBtn.classList.add('hidden');
        restTimer.classList.remove('hidden');
        
        restTimeDisplay.textContent = state.restSecondsRemaining;
        
        if (restInterval) clearInterval(restInterval);
        
        restInterval = setInterval(() => {
          state.restSecondsRemaining--;
          restTimeDisplay.textContent = state.restSecondsRemaining;
          
          if (state.restSecondsRemaining <= 3 && state.restSecondsRemaining > 0) {
            playBeep(600, 150);
          }
          
          if (state.restSecondsRemaining <= 0) {
            clearInterval(restInterval);
            endRestTimer();
            playBeep(1000, 300);
          }
        }, 1000);
      }

      function endRestTimer() {
        state.restTimerActive = false;
        restTimer.classList.add('hidden');
        repsInput.classList.remove('hidden');
        completeSetBtn.classList.remove('hidden');
        skipSetBtn.classList.remove('hidden');
        
        displayCurrentExercise();
      }

      // Stop workout
      function stopWorkout() {
        if (!confirm('Are you sure you want to end this workout early?')) return;
        
        if (restInterval) clearInterval(restInterval);
        
        state.workoutInProgress = false;
        activeWorkout.classList.add('hidden');
        workoutStatus.classList.remove('hidden');
        
        saveData();
      }

      // Finish workout
      function finishWorkout() {
        state.workoutInProgress = false;
        
        if (restInterval) clearInterval(restInterval);
        
        // Calculate stats
        let completedSets = 0;
        let skippedSets = 0;
        let totalReps = 0;
        
        state.workoutData.forEach(ex => {
          ex.sets.forEach(set => {
            if (set.reps !== null) {
              completedSets++;
              totalReps += set.reps;
            } else if (set.skipped) {
              skippedSets++;
            }
          });
        });

        const totalSets = state.workoutData.length * SETS_PER_EXERCISE;

        // Check for progressions
        const progressions = [];
        state.workoutData.forEach(ex => {
          const exLevel = state.exerciseLevels[ex.exercise.id];
          if (exLevel.successCount === 1) {
            progressions.push(`${ex.exercise.name}: One more successful workout to level up!`);
          }
        });

        // Save workout to history
        state.history.push({
          date: new Date().toISOString(),
          exercises: state.workoutData.map(ex => ({
            id: ex.exercise.id,
            name: ex.exercise.name,
            level: ex.level,
            target: ex.targetReps,
            sets: ex.sets
          })),
          totalReps,
          totalSets: completedSets,
          duration: null
        });

        saveData();
        updateStatsDisplay();

        // Display summary
        workoutSummary.innerHTML = `
          <div class="text-xl mb-3 font-semibold">Completed ${completedSets}/${totalSets} sets</div>
          <div class="text-sm text-slate-400">Total Reps: ${totalReps}</div>
          ${skippedSets > 0 ? `<div class="text-sm text-slate-500 mt-1">Skipped: ${skippedSets} sets</div>` : ''}
        `;

        if (progressions.length > 0) {
          progressionAdvice.innerHTML = `
            <div class="font-bold mb-3 text-purple-400 text-base">ðŸŽ¯ Progress Update</div>
            ${progressions.map(p => `<div class="text-sm text-slate-300 mb-2">â€¢ ${p}</div>`).join('')}
          `;
        } else {
          progressionAdvice.innerHTML = `
            <div class="font-bold mb-3 text-purple-400 text-base">ðŸ’ª Keep Training!</div>
            <div class="text-sm text-slate-300">Complete all 3 sets with target reps for 2 consecutive workouts to level up exercises.</div>
          `;
        }

        activeWorkout.classList.add('hidden');
        workoutComplete.classList.remove('hidden');
        
        playBeep(1500, 500);
        scrollToTop();
      }

      // Finish button
      finishBtn.addEventListener('click', () => {
        workoutComplete.classList.add('hidden');
        workoutStatus.classList.remove('hidden');
      });

      // Show history
      function showHistory() {
        const sortedHistory = [...state.history].reverse();
        
        if (sortedHistory.length === 0) {
          historyList.innerHTML = '<div class="text-slate-400 text-center py-12 glass-card rounded-xl">No workout history yet.<br><span class="text-sm text-slate-500 mt-2 inline-block">Complete your first workout to see it here!</span></div>';
          return;
        }

        historyList.innerHTML = sortedHistory.map((workout, idx) => {
          const date = new Date(workout.date);
          const dateStr = date.toLocaleDateString(undefined, {
            weekday: 'short',
            month: 'short',
            day: 'numeric',
            year: 'numeric'
          });
          
          const totalSets = workout.totalSets || 0;
          const maxSets = workout.exercises.length * 3;
          
          return `
            <div class="glass-card rounded-xl p-5">
              <div class="flex justify-between items-start mb-3">
                <div>
                  <div class="font-bold text-purple-400 mb-1">${dateStr}</div>
                  <div class="text-sm text-slate-400">${totalSets}/${maxSets} sets â€¢ ${workout.totalReps} reps</div>
                </div>
                <button 
                  onclick="deleteWorkout(${state.history.length - 1 - idx})" 
                  class="glass-card p-2 rounded-lg hover:bg-red-500/20 text-red-400 transition-all"
                  title="Delete"
                >
                  <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"/>
                  </svg>
                </button>
              </div>
              <div class="space-y-2 text-xs">
                ${workout.exercises.map(ex => {
                  const completedSets = ex.sets ? ex.sets.filter(s => s.reps !== null).length : 0;
                  const totalExSets = ex.sets ? ex.sets.length : 3;
                  return `<div class="text-slate-300 flex justify-between">
                    <span>${ex.name}</span>
                    <span class="text-slate-500">${completedSets}/${totalExSets} sets</span>
                  </div>`;
                }).join('')}
              </div>
            </div>
          `;
        }).join('');
      }

      // Delete workout
      window.deleteWorkout = function(index) {
        if (!confirm('Delete this workout from history?')) return;
        state.history.splice(index, 1);
        saveData();
        updateStatsDisplay();
        showHistory();
      };

      // Setup event listeners
      function setupEventListeners() {
        startWorkoutBtn.addEventListener('click', startWorkout);
        completeSetBtn.addEventListener('click', completeSet);
        skipSetBtn.addEventListener('click', skipSet);
        stopWorkoutBtn.addEventListener('click', stopWorkout);

        // Enter key on reps input
        repsInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') completeSet();
        });

        // Modals
        infoBtn.addEventListener('click', () => infoModal.classList.remove('hidden'));
        closeInfo.addEventListener('click', () => infoModal.classList.add('hidden'));
        
        historyBtn.addEventListener('click', () => {
          showHistory();
          historyModal.classList.remove('hidden');
        });
        closeHistory.addEventListener('click', () => historyModal.classList.add('hidden'));
        
        settingsBtn.addEventListener('click', () => settingsModal.classList.remove('hidden'));
        closeSettings.addEventListener('click', () => {
          state.settings.restTime = parseInt(restTimeSetting.value);
          state.settings.soundEnabled = soundAlerts.checked;
          saveData();
          settingsModal.classList.add('hidden');
        });

        // Close modals on backdrop click
        [infoModal, historyModal, settingsModal].forEach(modal => {
          modal.addEventListener('click', (e) => {
            if (e.target === modal) {
              modal.classList.add('hidden');
            }
          });
        });

        // Reset progress
        resetProgress.addEventListener('click', () => {
          if (!confirm('Are you sure you want to reset ALL progress? This cannot be undone!')) return;
          if (!confirm('Really reset? All workout history and levels will be lost!')) return;
          
          EXERCISES.forEach(ex => {
            state.exerciseLevels[ex.id] = { level: 1, successCount: 0 };
          });
          state.history = [];
          saveData();
          updateStatsDisplay();
          settingsModal.classList.add('hidden');
          alert('Progress reset complete');
        });
      }

      // Dark mode
      document.documentElement.classList.add('dark');

      // Initialize app
      init();
    </script>
  </body>
</html>
