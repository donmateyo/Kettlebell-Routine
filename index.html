<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kettlebell Pro</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Professional kettlebell workout app with strength circuits and HIIT training">
    <meta name="theme-color" content="#1a1a1a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Kettlebell Pro">
    <meta name="msapplication-TileColor" content="#1a1a1a">
    
    <!-- Manifest -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIktldHRsZWJlbGwgUHJvIiwKICAic2hvcnRfbmFtZSI6ICJLZXR0bGViZWxsIiwKICAiZGVzY3JpcHRpb24iOiAiUHJvZmVzc2lvbmFsIGtldHRsZWJlbGwgd29ya291dCBhcHAgd2l0aCBzdHJlbmd0aCBjaXJjdWl0cyBhbmQgSElJVCB0cmFpbmluZyIsCiAgInN0YXJ0X3VybCI6ICIuLyIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiIzFhMWExYSIsCiAgInRoZW1lX2NvbG9yIjogIiMxYTFhMWEiLAogICJvcmllbnRhdGlvbiI6ICJwb3J0cmFpdCIsCiAgImljb25zIjogWwogICAgewogICAgICAic3JjIjogImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjNhV1IwYUQwaU5USTBJaUJvWldsbmFIUTlJalV5TkNJZ2RtbGxkMEp2ZUQwaU1DQXdJRFV5TkNBMU1qUWlJR1pwYkd3OUlpTXdNR1ptTkRFaUlIaHRiRzV6UFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eU1EQXdMM04yWnlJK1BHTnBjbU5zWlNCamVEMGlNall5SWlCamVUMGlNall5SWlCeVBTSTJNQ0lnWm1sc2JEMGlJekF3Wm1ZME1TSWdMejQ4ZEdWNGRDQjRQU0l5TmpJaUlIazlJakkyTWlJZ1ptbHNiRDBpSTJabU16ZzJZbVFpSUdadmJuUXRabUZ0YVd4NVBTSnRiMjV2YzNCaFkyVWlJR1p2Ym5RdGMybDZaVDBpTlRRaUlIUmxlSFF0WVc1amFHOXlQU0p0YVdSa2JHVWlQang4UEM5MFpYaDBQand2YzNabkBlMCIsCiAgICAgICJzaXplcyI6ICIxOTJ4MTkyIiwKICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIKICAgIH0sCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCM2FXUjBhRDBpTlRJMElpQm9aV2xuYUhROUlqVXlOQ0lnZG1sbGQwSnZlRDBpTUNBd0lEVXlOQ0ExTWpRaUlHWnBiR3c5SWlNd01HWm1OREVpSUhodGJHNXpQU0pvZEhSd09pOHZkM2QzTG5jekxtOXlaeTh5TURBd0wzTjJaeUkrUEdOcGNtTnNaU0JqZUQwaU1qWXlJaUJqZVQwaU1qWXlJaUJ5UFNJMk1DSWdabWxzYkQwaUl6QXdabVkwTVNJZ0x6NDhkR1Y0ZENCNFBTSXlOaklpSUhrOUlqSTJNaUlnWm1sc2JEMGlJMlptTXpnMlltUWlJR1p2Ym5RdFptRnRhV3g1UFNKdGIyNXZjM0JoWTJVaUlHWnZiblF0YzJsNlpUMGlOVFFpSUhSbGVIUXRZVzVqYUc5eVBTSnRhV1JrYkdVaVB6eDhQQzlwWlhoMFB6d3ZjM1puUUdVd0lnPT0iLAogICAgICAic2l6ZXMiOiAiNTEyeDUxMiIsCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiCiAgICB9CiAgXSwKICAiY2F0ZWdvcmllcyI6IFsiaGVhbHRoIiwgImZpdG5lc3MiLCAic3BvcnRzIl0sCiAgImxhbmciOiAiZW4iCn0="
    >
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'dark-bg': '#1a1a1a',
                        'dark-card': '#2d2d2d',
                        'dark-border': '#404040',
                        'electric-green': '#00ff41',
                        'electric-green-dark': '#00cc33',
                        'electric-blue': '#00bfff',
                        'electric-blue-dark': '#0099cc'
                    }
                }
            }
        }
    </script>
    <style>
        /* Prevent zoom and maintain stable layout */
        * {
            touch-action: manipulation;
        }
        
        body {
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
            text-size-adjust: 100%;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            overscroll-behavior: none;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        
        /* Allow text selection only on input fields */
        input, textarea {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }
        
        /* Enhanced animations and effects */
        .timer-ring {
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
            transition: stroke-dashoffset 0.3s ease;
        }
        
        .exercise-card {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
        }
        
        .exercise-card:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        /* Button enhancements */
        button {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        button:active {
            transform: scale(0.98);
        }
        
        /* Ripple effect for buttons */
        button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transition: width 0.6s, height 0.6s, top 0.6s, left 0.6s;
            transform: translate(-50%, -50%);
            z-index: 0;
        }
        
        button:active::before {
            width: 300px;
            height: 300px;
        }
        
        button > * {
            position: relative;
            z-index: 1;
        }
        
        /* Input field enhancements */
        input[type="number"] {
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        input[type="number"]:focus {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.3);
        }
        
        /* Enhanced shadows */
        .shadow-lg {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2), 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        /* Gradient text effects */
        .gradient-text {
            background: linear-gradient(135deg, #00ff41, #00bfff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* Pulse animation for active elements */
        @keyframes pulse-glow {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(0, 255, 65, 0.4);
            }
            50% { 
                box-shadow: 0 0 30px rgba(0, 255, 65, 0.6), 0 0 40px rgba(0, 255, 65, 0.3);
            }
        }
        
        .pulse-active {
            animation: pulse-glow 2s infinite;
        }
        
        /* Enhanced timer display */
        #timer-display {
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
            font-weight: 700;
            letter-spacing: -0.02em;
        }
        
        /* Smooth page transitions */
        #app > div {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        
        #app > div.hidden {
            opacity: 0;
            transform: translateY(10px);
            pointer-events: none;
        }
        
        /* Enhanced stats cards */
        .stats-item {
            transition: transform 0.2s ease;
        }
        
        .stats-item:hover {
            transform: scale(1.05);
        }
        
        /* Progress ring enhancements */
        .timer-progress-container {
            filter: drop-shadow(0 0 10px rgba(0, 0, 0, 0.3));
        }
        
        /* Set completion animation */
        @keyframes set-complete {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        
        .set-complete-animation {
            animation: set-complete 0.4s ease;
        }
        
        /* Loading states */
        .loading-shimmer {
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: shimmer 1.5s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        /* Enhanced focus states */
        button:focus-visible, input:focus-visible {
            outline: 2px solid #00ff41;
            outline-offset: 2px;
        }
        
        /* Improved scrolling */
        * {
            scroll-behavior: smooth;
        }
        
        /* Enhanced modal animations */
        .modal-enter {
            animation: modal-fade-in 0.3s ease;
        }
        
        @keyframes modal-fade-in {
            from { 
                opacity: 0; 
                transform: scale(0.9);
            }
            to { 
                opacity: 1; 
                transform: scale(1);
            }
        }
    </style>
</head>
<body class="bg-dark-bg text-white min-h-screen">
    <div id="app" class="max-w-4xl mx-auto p-4">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-white mb-2">üèãÔ∏è Kettlebell Pro</h1>
            <p class="text-gray-400">Master your kettlebell workouts with precision</p>
        </header>

        <!-- Main Content -->
        <div id="home-screen" class="space-y-6">
            <!-- Workout Templates -->
            <div class="grid md:grid-cols-2 gap-6">
                <!-- Full-Body Strength Circuit -->
                <div class="exercise-card bg-dark-card rounded-xl shadow-lg p-6 border border-dark-border">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-electric-green rounded-lg flex items-center justify-center text-black font-bold text-xl mr-4">üí™</div>
                        <div>
                            <h3 class="text-xl font-bold text-electric-green">Full-Body Strength Circuit</h3>
                            <p class="text-sm text-gray-400">3-8 reps ‚Ä¢ 30-40 min</p>
                        </div>
                    </div>
                    <p class="text-gray-300 mb-4">Build strength with Dan John's Five Fundamental Movements. Focus on quality over quantity.</p>
                    <button onclick="startWorkout('strength')" class="w-full bg-electric-green hover:bg-electric-green-dark text-black font-semibold py-3 px-4 rounded-lg transition-colors">
                        Start Strength Workout
                    </button>
                </div>

                <!-- HIIT Conditioner -->
                <div class="exercise-card bg-dark-card rounded-xl shadow-lg p-6 border border-dark-border">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-electric-blue rounded-lg flex items-center justify-center text-black font-bold text-xl mr-4">üî•</div>
                        <div>
                            <h3 class="text-xl font-bold text-electric-blue">HIIT Conditioner</h3>
                            <p class="text-sm text-gray-400">30s on/30s off ‚Ä¢ 30 min</p>
                        </div>
                    </div>
                    <p class="text-gray-300 mb-4">High-intensity intervals for maximum cardiovascular benefits and fat loss.</p>
                    <button onclick="startWorkout('hiit')" class="w-full bg-electric-blue hover:bg-electric-blue-dark text-black font-semibold py-3 px-4 rounded-lg transition-colors">
                        Start HIIT Workout
                    </button>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="bg-gradient-to-r from-electric-green to-electric-blue rounded-xl text-black p-6">
                <h3 class="text-xl font-bold mb-4">Today's Session</h3>
                <div class="grid grid-cols-3 gap-4 text-center">
                    <div>
                        <div class="text-2xl font-bold" id="total-workouts">0</div>
                        <div class="text-sm opacity-80">Workouts</div>
                    </div>
                    <div>
                        <div class="text-2xl font-bold" id="total-time">0m</div>
                        <div class="text-sm opacity-80">Total Time</div>
                    </div>
                    <div>
                        <div class="text-2xl font-bold" id="total-reps">0</div>
                        <div class="text-sm opacity-80">Reps</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Workout Screen -->
        <div id="workout-screen" class="hidden">
            <!-- Workout Header -->
            <div class="flex items-center justify-between mb-6">
                <button onclick="exitWorkout()" class="flex items-center text-gray-400 hover:text-white">
                    <svg class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                    Back
                </button>
                <div class="text-center flex-1">
                    <h2 id="workout-title" class="text-2xl font-bold"></h2>
                    <p id="workout-progress" class="text-sm text-gray-400"></p>
                    <div id="workout-time-display" class="hidden text-lg font-bold mt-1"></div>
                </div>
                <div class="w-16"></div>
            </div>

            <!-- Timer Display -->
            <div id="timer-section" class="text-center mb-8">
                <div class="relative inline-block">
                    <svg class="w-32 h-32 md:w-40 md:h-40" viewBox="0 0 120 120">
                        <circle cx="60" cy="60" r="50" fill="none" stroke="#404040" stroke-width="8"/>
                        <circle id="timer-progress" cx="60" cy="60" r="50" fill="none" stroke-width="8" 
                                class="timer-ring" stroke-dasharray="314" stroke-dashoffset="314"/>
                    </svg>
                    <div class="absolute inset-0 flex items-center justify-center">
                        <div class="text-center">
                            <div id="timer-display" class="text-3xl md:text-4xl font-bold">00:30</div>
                            <div id="timer-label" class="text-sm text-gray-400">Get Ready</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Current Exercise -->
            <div id="current-exercise" class="bg-dark-card rounded-xl shadow-lg p-6 mb-6 border border-dark-border">
                <div class="text-center">
                    <h3 id="exercise-name" class="text-2xl font-bold mb-2">Get Ready</h3>
                    <p id="exercise-reps" class="text-gray-400 mb-4">Prepare for your workout</p>
                    <div id="exercise-demo" class="bg-dark-bg rounded-lg p-4 text-sm text-gray-300 hidden">
                        <h4 class="font-semibold mb-2">How to perform:</h4>
                        <p id="exercise-description"></p>
                    </div>
                </div>
            </div>

            <!-- Set Tracking (for Strength workouts) -->
            <div id="set-tracking" class="hidden bg-dark-card rounded-xl shadow-lg p-6 mb-6 border border-dark-border">
                <h4 class="font-bold mb-4 text-electric-green">Track Your Sets</h4>
                <div id="sets-container" class="space-y-3"></div>
                <div class="flex gap-3 mt-4">
                    <button onclick="completeSet()" id="complete-set-btn" class="flex-1 bg-electric-green hover:bg-electric-green-dark text-black font-semibold py-3 px-4 rounded-lg transition-colors">
                        Complete Set
                    </button>
                    <button onclick="nextExercise()" id="next-exercise-btn" class="flex-1 bg-electric-green hover:bg-electric-green-dark text-black font-semibold py-3 px-4 rounded-lg transition-colors">
                        Next Exercise
                    </button>
                </div>
            </div>

            <!-- Control Buttons -->
            <div id="workout-controls" class="grid grid-cols-3 gap-3">
                <button onclick="skipExercise()" class="bg-gray-600 hover:bg-gray-500 text-white font-semibold py-3 px-4 rounded-lg transition-colors">
                    Skip
                </button>
                <button onclick="toggleTimer()" id="timer-control-btn" class="font-semibold py-3 px-4 rounded-lg transition-colors">
                    Start
                </button>
                <button onclick="endWorkoutEarly()" class="bg-red-600 hover:bg-red-500 text-white font-semibold py-3 px-4 rounded-lg transition-colors">
                    End Workout
                </button>
            </div>
        </div>

        <!-- Workout Complete Screen -->
        <div id="complete-screen" class="hidden text-center">
            <div id="completion-banner" class="rounded-xl text-black p-8 mb-6">
                <div class="text-6xl mb-4">üéâ</div>
                <h2 class="text-3xl font-bold mb-2">Workout Complete!</h2>
                <p class="text-lg opacity-90">Great job pushing through your session</p>
            </div>

            <div class="bg-dark-card rounded-xl shadow-lg p-6 mb-6 border border-dark-border">
                <h3 class="text-xl font-bold mb-4">Session Summary</h3>
                <div class="grid grid-cols-2 gap-4 text-center">
                    <div>
                        <div class="text-2xl font-bold" id="final-duration">0m</div>
                        <div class="text-sm text-gray-400">Duration</div>
                    </div>
                    <div>
                        <div class="text-2xl font-bold" id="final-exercises">0</div>
                        <div class="text-sm text-gray-400">Exercises</div>
                    </div>
                </div>
            </div>

            <button onclick="returnHome()" id="return-home-btn" class="w-full font-semibold py-3 px-4 rounded-lg transition-colors">
                Back to Home
            </button>
        </div>
    </div>

    <script>
        // App State
        let currentWorkout = null;
        let currentExerciseIndex = 0;
        let currentRound = 1;
        let isTimerRunning = false;
        let timeRemaining = 0;
        let timerInterval = null;
        let workoutStartTime = null;
        let completedSets = [];
        let currentSetIndex = 0;
        let totalStats = { workouts: 0, time: 0, reps: 0 };
        let workoutTimeRemaining = 0;
        let workoutTimerInterval = null;

        // Workout Templates
        const workoutTemplates = {
            strength: {
                name: "Full-Body Strength Circuit",
                type: "strength",
                exercises: [
                    {
                        name: "Goblet Squat",
                        sets: 3,
                        reps: "5-8",
                        restTime: 90,
                        description: "Hold kettlebell close to chest, squat down keeping chest up, drive through heels to stand."
                    },
                    {
                        name: "Single-Arm Overhead Press",
                        sets: 3,
                        reps: "3-8 per side",
                        restTime: 90,
                        description: "Press kettlebell from shoulder to overhead, keep core tight, lower with control."
                    },
                    {
                        name: "Single-Arm Bent-Over Row",
                        sets: 3,
                        reps: "5-8 per side",
                        restTime: 90,
                        description: "Hinge at hips, pull kettlebell to ribs, squeeze shoulder blade, lower with control."
                    },
                    {
                        name: "Kettlebell Swings",
                        sets: 5,
                        reps: "10-15",
                        restTime: 60,
                        description: "Hinge at hips, swing kettlebell to shoulder height using hip drive, not arms."
                    },
                    {
                        name: "Suitcase Carry",
                        sets: 3,
                        reps: "45 seconds per side",
                        restTime: 60,
                        description: "Hold kettlebell at side, walk while maintaining perfect posture and core engagement."
                    }
                ]
            },
            hiit: {
                name: "HIIT Conditioner",
                type: "hiit",
                workTime: 30,
                restTime: 30,
                totalDuration: 1800,
                exercises: [
                    {
                        name: "Single-Arm Swings (Right)",
                        description: "Explosive hip drive, swing to eye level, one arm at a time for increased core demand."
                    },
                    {
                        name: "Single-Arm Swings (Left)",
                        description: "Switch to left arm, maintain same power and form as right side."
                    },
                    {
                        name: "Goblet Squats",
                        description: "Fast tempo squats, maintain depth and form despite fatigue."
                    },
                    {
                        name: "Push-ups",
                        description: "Standard push-ups or modify to knees if needed. Focus on good form."
                    }
                ]
            }
        };

        // Theme Management
        function applyWorkoutTheme(workoutType) {
            const isStrength = workoutType === 'strength';
            const primaryColor = isStrength ? '#00ff41' : '#00bfff';
            const primaryColorHover = isStrength ? '#00cc33' : '#0099cc';
            
            // Update timer progress color
            document.getElementById('timer-progress').style.stroke = primaryColor;
            
            // Update workout time display color
            const timeDisplay = document.getElementById('workout-time-display');
            timeDisplay.style.color = primaryColor;
            
            // Update timer control button
            const timerBtn = document.getElementById('timer-control-btn');
            timerBtn.style.backgroundColor = primaryColor;
            timerBtn.style.color = 'black';
            timerBtn.onmouseover = () => timerBtn.style.backgroundColor = primaryColorHover;
            timerBtn.onmouseout = () => timerBtn.style.backgroundColor = primaryColor;
            
            // Update completion screen
            const banner = document.getElementById('completion-banner');
            const returnBtn = document.getElementById('return-home-btn');
            const finalDuration = document.getElementById('final-duration');
            const finalExercises = document.getElementById('final-exercises');
            
            banner.style.background = `linear-gradient(to right, ${primaryColor}, ${primaryColorHover})`;
            returnBtn.style.backgroundColor = primaryColor;
            returnBtn.style.color = 'black';
            returnBtn.onmouseover = () => returnBtn.style.backgroundColor = primaryColorHover;
            returnBtn.onmouseout = () => returnBtn.style.backgroundColor = primaryColor;
            
            finalDuration.style.color = primaryColor;
            finalExercises.style.color = primaryColor;
        }

        // UI Functions
        function showScreen(screenId) {
            document.querySelectorAll('#app > div').forEach(screen => {
                screen.classList.add('hidden');
            });
            document.getElementById(screenId).classList.remove('hidden');
        }

        function startWorkout(type) {
            currentWorkout = workoutTemplates[type];
            currentExerciseIndex = 0;
            currentRound = 1;
            currentSetIndex = 0;
            completedSets = [];
            workoutStartTime = Date.now();
            
            applyWorkoutTheme(type);
            showScreen('workout-screen');
            document.getElementById('workout-title').textContent = currentWorkout.name;
            
            if (currentWorkout.type === 'hiit') {
                setupHIITWorkout();
            } else {
                setupStrengthWorkout();
            }
        }

        function setupHIITWorkout() {
            workoutTimeRemaining = currentWorkout.totalDuration;
            currentRound = 1;
            
            document.getElementById('workout-time-display').classList.remove('hidden');
            updateWorkoutTimeDisplay();
            startWorkoutTimer();
            updateWorkoutProgress();
            
            timeRemaining = 10;
            updateTimerDisplay();
            document.getElementById('timer-label').textContent = 'Get Ready';
            document.getElementById('exercise-name').textContent = 'Prepare for HIIT';
            document.getElementById('exercise-reps').textContent = `Get ready to start your workout!`;
            document.getElementById('exercise-demo').classList.add('hidden');
            
            document.getElementById('set-tracking').classList.add('hidden');
            startCountdown();
        }

        function setupStrengthWorkout() {
            document.getElementById('workout-time-display').classList.add('hidden');
            updateWorkoutProgress();
            showCurrentExercise();
            document.getElementById('set-tracking').classList.remove('hidden');
            document.getElementById('timer-section').classList.add('hidden');
            document.getElementById('workout-controls').classList.add('hidden');
            setupSetTracking();
        }

        function setupSetTracking() {
            const exercise = currentWorkout.exercises[currentExerciseIndex];
            const container = document.getElementById('sets-container');
            container.innerHTML = '';
            
            for (let i = 0; i < exercise.sets; i++) {
                const setDiv = document.createElement('div');
                setDiv.className = 'flex items-center justify-between p-3 bg-dark-bg rounded-lg';
                setDiv.innerHTML = `
                    <div class="flex items-center">
                        <span class="text-white mr-3">Set ${i + 1}</span>
                        <span class="text-sm text-gray-400">Target: ${exercise.reps}</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <input type="number" id="reps-input-${i}" placeholder="Reps" min="0" max="50" 
                               class="w-16 px-2 py-1 bg-dark-card border border-dark-border rounded text-white text-center text-sm focus:border-electric-green focus:outline-none ${i === 0 ? '' : 'hidden'}" />
                        <div class="w-6 h-6 border-2 border-gray-500 rounded-full flex items-center justify-center" id="set-${i}">
                            <span id="set-reps-${i}" class="text-xs text-white hidden"></span>
                        </div>
                    </div>
                `;
                container.appendChild(setDiv);
            }
            
            currentSetIndex = 0;
            updateSetButtons();
        }

        function completeSet() {
            const exercise = currentWorkout.exercises[currentExerciseIndex];
            if (currentSetIndex < exercise.sets) {
                // Get the rep count from input
                const repsInput = document.getElementById(`reps-input-${currentSetIndex}`);
                const reps = parseInt(repsInput.value) || 0;
                
                if (reps === 0) {
                    showCustomAlert("Please enter the number of reps completed");
                    repsInput.focus();
                    return;
                }
                
                // Store the completed reps
                if (!completedSets[currentExerciseIndex]) {
                    completedSets[currentExerciseIndex] = [];
                }
                completedSets[currentExerciseIndex][currentSetIndex] = reps;
                
                // Update total reps
                totalStats.reps += reps;
                updateTotalStats();
                
                // Mark set as complete and show reps
                document.getElementById(`set-${currentSetIndex}`).className = 'w-6 h-6 bg-electric-green text-black rounded-full flex items-center justify-center text-xs font-bold';
                document.getElementById(`set-${currentSetIndex}`).textContent = reps;
                
                // Hide current input and show next one
                repsInput.classList.add('hidden');
                currentSetIndex++;
                
                if (currentSetIndex < exercise.sets) {
                    // Show next input field
                    const nextInput = document.getElementById(`reps-input-${currentSetIndex}`);
                    nextInput.classList.remove('hidden');
                    
                    // Start rest timer
                    timeRemaining = exercise.restTime;
                    document.getElementById('timer-section').classList.remove('hidden');
                    document.getElementById('timer-label').textContent = 'Rest';
                    document.getElementById('workout-controls').classList.remove('hidden');
                    updateTimerDisplay();
                    startCountdown();
                    
                    // Focus on next input after rest
                    setTimeout(() => {
                        nextInput.focus();
                    }, exercise.restTime * 1000 + 100);
                }
                
                updateSetButtons();
            }
        }

        function updateSetButtons() {
            const exercise = currentWorkout.exercises[currentExerciseIndex];
            const completeBtn = document.getElementById('complete-set-btn');
            const nextBtn = document.getElementById('next-exercise-btn');
            
            if (currentSetIndex >= exercise.sets) {
                completeBtn.classList.add('hidden');
                nextBtn.classList.remove('hidden');
            } else {
                completeBtn.classList.remove('hidden');
                nextBtn.classList.add('hidden');
            }
        }

        function nextExercise() {
            currentExerciseIndex++;
            currentSetIndex = 0;
            
            if (currentExerciseIndex >= currentWorkout.exercises.length) {
                completeWorkout();
                return;
            }
            
            showCurrentExercise();
            setupSetTracking();
            document.getElementById('timer-section').classList.add('hidden');
            document.getElementById('workout-controls').classList.add('hidden');
        }

        function showCurrentExercise() {
            if (currentWorkout.type === 'hiit') {
                const exercise = currentWorkout.exercises[currentExerciseIndex];
                document.getElementById('exercise-name').textContent = exercise.name;
                document.getElementById('exercise-reps').textContent = `${currentWorkout.workTime} seconds`;
                document.getElementById('exercise-description').textContent = exercise.description;
                document.getElementById('exercise-demo').classList.remove('hidden');
            } else {
                const exercise = currentWorkout.exercises[currentExerciseIndex];
                document.getElementById('exercise-name').textContent = exercise.name;
                document.getElementById('exercise-reps').textContent = `${exercise.sets} sets of ${exercise.reps}`;
                document.getElementById('exercise-description').textContent = exercise.description;
                document.getElementById('exercise-demo').classList.remove('hidden');
            }
            
            updateWorkoutProgress();
        }

        function updateWorkoutProgress() {
            if (currentWorkout.type === 'hiit') {
                document.getElementById('workout-progress').textContent = 
                    `Round ${currentRound} ‚Ä¢ Exercise ${currentExerciseIndex + 1} of ${currentWorkout.exercises.length}`;
            } else {
                document.getElementById('workout-progress').textContent = 
                    `Exercise ${currentExerciseIndex + 1} of ${currentWorkout.exercises.length}`;
            }
        }

        function startWorkoutTimer() {
            if (workoutTimerInterval) clearInterval(workoutTimerInterval);
            
            workoutTimerInterval = setInterval(() => {
                if (workoutTimeRemaining > 0) {
                    workoutTimeRemaining--;
                    updateWorkoutTimeDisplay();
                } else {
                    clearInterval(workoutTimerInterval);
                    completeWorkout();
                }
            }, 1000);
        }

        function updateWorkoutTimeDisplay() {
            const minutes = Math.floor(workoutTimeRemaining / 60);
            const seconds = workoutTimeRemaining % 60;
            document.getElementById('workout-time-display').textContent = 
                `Time Remaining: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function startCountdown() {
            if (timerInterval) clearInterval(timerInterval);
            
            timerInterval = setInterval(() => {
                if (timeRemaining > 0) {
                    timeRemaining--;
                    
                    // Audio cues for countdown
                    if (timeRemaining <= 3 && timeRemaining > 0) {
                        playAudioCue('countdown');
                    }
                    
                    updateTimerDisplay();
                } else {
                    clearInterval(timerInterval);
                    handleTimerComplete();
                }
            }, 1000);
            
            isTimerRunning = true;
            updateTimerButton();
        }

        function handleTimerComplete() {
            if (currentWorkout.type === 'hiit') {
                handleHIITTimerComplete();
            } else {
                // Strength workout rest period complete
                playAudioCue('start');
                document.getElementById('timer-section').classList.add('hidden');
                document.getElementById('workout-controls').classList.add('hidden');
            }
        }

        function handleHIITTimerComplete() {
            if (document.getElementById('timer-label').textContent === 'Get Ready') {
                // Start work period
                playAudioCue('start');
                showCurrentExercise();
                timeRemaining = currentWorkout.workTime;
                document.getElementById('timer-label').textContent = 'Work';
                updateTimerDisplay();
                startCountdown();
            } else if (document.getElementById('timer-label').textContent === 'Work') {
                // Work period complete, start rest
                playAudioCue('rest');
                currentExerciseIndex++;
                if (currentExerciseIndex >= currentWorkout.exercises.length) {
                    currentRound++;
                    currentExerciseIndex = 0;
                    
                    timeRemaining = 60;
                    document.getElementById('timer-label').textContent = 'Round Rest';
                    document.getElementById('exercise-name').textContent = 'Round Complete!';
                    document.getElementById('exercise-reps').textContent = `${currentRound-1} rounds completed`;
                    updateWorkoutProgress();
                } else {
                    timeRemaining = currentWorkout.restTime;
                    document.getElementById('timer-label').textContent = 'Rest';
                }
                updateTimerDisplay();
                startCountdown();
            } else {
                // Rest period complete, start next work period
                playAudioCue('start');
                showCurrentExercise();
                timeRemaining = currentWorkout.workTime;
                document.getElementById('timer-label').textContent = 'Work';
                updateTimerDisplay();
                startCountdown();
            }
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timer-display').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            const totalTime = document.getElementById('timer-label').textContent === 'Work' ? 
                currentWorkout.workTime : 
                (document.getElementById('timer-label').textContent === 'Round Rest' ? 60 : currentWorkout.restTime || 90);
            
            const progress = ((totalTime - timeRemaining) / totalTime) * 314;
            document.getElementById('timer-progress').style.strokeDashoffset = 314 - progress;
        }

        function toggleTimer() {
            if (isTimerRunning) {
                clearInterval(timerInterval);
                isTimerRunning = false;
            } else {
                startCountdown();
            }
            updateTimerButton();
        }

        function updateTimerButton() {
            const btn = document.getElementById('timer-control-btn');
            btn.textContent = isTimerRunning ? 'Pause' : 'Start';
        }

        function skipExercise() {
            clearInterval(timerInterval);
            handleTimerComplete();
        }

        function pauseWorkout() {
            if (timerInterval) {
                clearInterval(timerInterval);
                isTimerRunning = false;
                updateTimerButton();
            }
            if (workoutTimerInterval) {
                clearInterval(workoutTimerInterval);
            }
        }

        function exitWorkout() {
            if (timerInterval) clearInterval(timerInterval);
            if (workoutTimerInterval) clearInterval(workoutTimerInterval);
            showCustomConfirmDialog("Are you sure you want to exit this workout?", () => {
                returnHome();
            });
        }

        function endWorkoutEarly() {
            showCustomConfirmDialog("Are you sure you want to end this workout early?", () => {
                completeWorkout();
            });
        }

        function completeWorkout() {
            if (timerInterval) clearInterval(timerInterval);
            if (workoutTimerInterval) clearInterval(workoutTimerInterval);
            
            const duration = Math.round((Date.now() - workoutStartTime) / 1000 / 60);
            totalStats.workouts++;
            totalStats.time += duration;
            
            document.getElementById('final-duration').textContent = `${duration}m`;
            
            if (currentWorkout.type === 'hiit') {
                document.getElementById('final-exercises').textContent = currentRound - 1;
                document.querySelectorAll('#complete-screen .text-sm')[1].textContent = 'Rounds';
            } else {
                document.getElementById('final-exercises').textContent = currentWorkout.exercises.length;
                document.querySelectorAll('#complete-screen .text-sm')[1].textContent = 'Exercises';
            }
            
            updateTotalStats();
            playAudioCue('complete');
            showScreen('complete-screen');
        }

        function returnHome() {
            currentWorkout = null;
            currentExerciseIndex = 0;
            currentRound = 1;
            showScreen('home-screen');
        }

        function updateTotalStats() {
            document.getElementById('total-workouts').textContent = totalStats.workouts;
            document.getElementById('total-time').textContent = `${totalStats.time}m`;
            document.getElementById('total-reps').textContent = totalStats.reps;
        }

        function showCustomConfirmDialog(message, onConfirm) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-dark-card p-6 rounded-lg shadow-lg max-w-sm w-full mx-4 border border-dark-border">
                    <p class="text-gray-300 mb-4">${message}</p>
                    <div class="flex justify-end space-x-3">
                        <button class="px-4 py-2 text-gray-400 hover:bg-dark-bg rounded" onclick="this.closest('.fixed').remove()">Cancel</button>
                        <button class="px-4 py-2 bg-red-500 text-white hover:bg-red-600 rounded" onclick="this.closest('.fixed').remove(); (${onConfirm})()">Confirm</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function showCustomAlert(message) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-dark-card p-6 rounded-lg shadow-lg max-w-sm w-full mx-4 border border-dark-border">
                    <p class="text-gray-300 mb-4">${message}</p>
                    <div class="flex justify-end">
                        <button class="px-4 py-2 bg-electric-green text-black hover:bg-electric-green-dark rounded" onclick="this.closest('.fixed').remove()">OK</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Audio System
        let audioContext;
        let isAudioEnabled = true;
        let audioInitialized = false;

        // Initialize audio context with user interaction
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            
            // Resume audio context if suspended (required by browser policies)
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
        }

        // Enable audio with user interaction (required by browsers)
        function enableAudio() {
            if (!audioInitialized) {
                initAudio();
                audioInitialized = true;
                
                // Test audio to ensure it works
                if (audioContext && audioContext.state === 'running') {
                    // Play a very quiet test tone
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
                    gainNode.gain.setValueAtTime(0.001, audioContext.currentTime); // Very quiet
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.01);
                    
                    console.log('Audio enabled successfully');
                }
            }
        }

        // Add click event listeners to enable audio on first interaction
        document.addEventListener('click', enableAudio, { once: true });
        document.addEventListener('touchstart', enableAudio, { once: true });

        // Play different audio cues
        async function playAudioCue(type) {
            if (!isAudioEnabled) return;
            
            try {
                initAudio();
                
                // Always ensure audio context is running before playing
                if (audioContext.state === 'suspended') {
                    await audioContext.resume();
                }
                
                // Wait a moment for context to be fully ready
                if (audioContext.state !== 'running') {
                    console.log('Audio context not ready:', audioContext.state);
                    return;
                }
                
                let frequency, duration, volume;
                
                switch(type) {
                    case 'countdown':
                        frequency = 800;
                        duration = 0.1;
                        volume = 0.3;
                        break;
                    case 'start':
                        frequency = 600;
                        duration = 0.3;
                        volume = 0.4;
                        break;
                    case 'rest':
                        frequency = 400;
                        duration = 0.5;
                        volume = 0.3;
                        break;
                    case 'complete':
                        // Play a success chord
                        playSuccessChord();
                        return;
                    case 'warning':
                        frequency = 1000;
                        duration = 0.2;
                        volume = 0.4;
                        break;
                    default:
                        frequency = 500;
                        duration = 0.2;
                        volume = 0.3;
                }
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(volume, audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration);
                
            } catch (error) {
                console.log('Audio playback failed:', error);
            }
        }

        function playSuccessChord() {
            if (!isAudioEnabled) return;
            
            initAudio();
            
            const frequencies = [523, 659, 784]; // C, E, G major chord
            frequencies.forEach((freq, index) => {
                setTimeout(() => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(freq, audioContext.currentTime);
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                    gainNode.gain.linearRampToValueAtTime(0.2, audioContext.currentTime + 0.01);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.8);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.8);
                }, index * 100);
            });
        }

        // PWA Installation
        let deferredPrompt;
        let installButton;

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const swScript = `
                    const CACHE_NAME = 'kettlebell-pro-v1';
                    const urlsToCache = [
                        './',
                        'https://cdn.tailwindcss.com'
                    ];

                    self.addEventListener('install', event => {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then(cache => cache.addAll(urlsToCache))
                        );
                    });

                    self.addEventListener('fetch', event => {
                        event.respondWith(
                            caches.match(event.request)
                                .then(response => {
                                    if (response) {
                                        return response;
                                    }
                                    return fetch(event.request);
                                }
                            )
                        );
                    });
                `;
                
                const blob = new Blob([swScript], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swUrl)
                    .then(registration => {
                        console.log('SW registered: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }

        // Install prompt handling
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            showInstallButton();
        });

        function showInstallButton() {
            // Only show install button on home screen
            if (document.getElementById('home-screen').classList.contains('hidden')) return;
            
            if (!installButton) {
                installButton = document.createElement('button');
                installButton.innerHTML = 'üì± Install App';
                installButton.className = 'fixed bottom-4 right-4 bg-electric-green hover:bg-electric-green-dark text-black font-semibold py-3 px-4 rounded-full shadow-lg transition-all z-50';
                installButton.onclick = installApp;
                document.body.appendChild(installButton);
            }
        }

        function hideInstallButton() {
            if (installButton) {
                installButton.remove();
                installButton = null;
            }
        }

        async function installApp() {
            if (!deferredPrompt) return;
            
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            
            if (outcome === 'accepted') {
                console.log('User accepted the install prompt');
                hideInstallButton();
            }
            
            deferredPrompt = null;
        }

        // Handle successful installation
        window.addEventListener('appinstalled', () => {
            console.log('PWA was installed');
            hideInstallButton();
        });

        // Enhanced showScreen function to handle install button
        const originalShowScreen = showScreen;
        showScreen = function(screenId) {
            originalShowScreen(screenId);
            
            // Show install button only on home screen
            if (screenId === 'home-screen' && deferredPrompt) {
                showInstallButton();
            } else {
                hideInstallButton();
            }
        };

        // Initialize app
        updateTotalStats();
    </script>
</body>
</html>
